function formatNumber(e){return null==e?"0":e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}let lastToastTime=0;function showToast(e,t="info",o=3e3){const n=Date.now();if(n-lastToastTime<300)return;lastToastTime=n;const s=document.createElement("div");s.className=`toast toast-${t}`;let i="fas fa-info-circle",r="#3498db";switch(t){case"success":i="fas fa-check-circle",r="#27ae60";break;case"error":i="fas fa-times-circle",r="#e74c3c";break;case"warning":i="fas fa-exclamation-circle",r="#f39c12"}s.innerHTML=`<div style="display: flex; align-items: center; gap: 10px;"><i class="${i}"></i><span>${e}</span></div>`,s.style.cssText=`position: fixed; bottom: 20px; right: 20px; background: ${r}; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000; font-family: 'Cairo'; animation: slideInUp 0.3s ease; max-width: 300px;`,document.body.appendChild(s),setTimeout(()=>{s.style.animation="slideOutDown 0.3s ease",setTimeout(()=>s.remove(),300)},o)}function showLoadingSpinner(e="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."){const t=document.createElement("div");t.id="customLoadingSpinner",t.style.cssText="\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background: rgba(0,0,0,0.7); display: flex; flex-direction: column;\n        justify-content: center; align-items: center; z-index: 9999;\n        color: white; font-family: 'Cairo';\n    ",t.innerHTML=`\n        <div class="loader-spinner" style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></div>\n        <p style="margin-top: 15px;">${e}</p>\n    `,document.body.appendChild(t)}function hideLoadingSpinner(){const e=document.getElementById("customLoadingSpinner");e&&e.remove()}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function isValidPhone(e){return/^[0-9+\-\s()]{7,}$/.test(e)}function generateGuestUID(){return"guest_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}const firebaseConfig={apiKey:"AIzaSyB1vNmCapPK0MI4H_Q0ilO7OnOgZa02jx0",authDomain:"queen-beauty-b811b.firebaseapp.com",projectId:"queen-beauty-b811b",storageBucket:"queen-beauty-b811b.firebasestorage.app",messagingSenderId:"418964206430",appId:"1:418964206430:web:8c9451fc56ca7f956bd5cf"};let firebaseApp=null,firebaseAuth=null,firebaseDb=null,firebaseStorage=null;function initializeFirebaseApp(e="DefaultApp"){if(firebaseApp&&"DefaultApp"===e)return{app:firebaseApp,auth:firebaseAuth,db:firebaseDb,storage:firebaseStorage};try{if(!window.firebaseModules)throw new Error("Firebase SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡");const t=window.firebaseModules.initializeApp(firebaseConfig,e),o=window.firebaseModules.getAuth(t),n=window.firebaseModules.getFirestore(t),s=window.firebaseModules.getStorage(t);return"DefaultApp"===e&&(firebaseApp=t,firebaseAuth=o,firebaseDb=n,firebaseStorage=s),console.log(`âœ… Firebase Ù…Ù‡ÙŠØ£ (${e})`),{app:t,auth:o,db:n,storage:s}}catch(e){throw console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:",e),e}}function getFirebaseInstance(){if(!firebaseApp)throw new Error("Firebase Ù„Ù… ÙŠØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ø¹Ø¯");return{app:firebaseApp,auth:firebaseAuth,db:firebaseDb,storage:firebaseStorage}}async function checkFirebaseConnection(){try{if(!firebaseDb)throw new Error("Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…Ù‡ÙŠØ£Ø©");const e=window.firebaseModules.collection(firebaseDb,"settings");return await window.firebaseModules.getDocs(e),console.log("âœ… Ø§ØªØµØ§Ù„ Firebase Ù†Ø§Ø¬Ø­"),!0}catch(e){return console.error("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„:",e),!1}}window.firebaseConfig=firebaseConfig,window.initializeFirebaseApp=initializeFirebaseApp,window.getFirebaseInstance=getFirebaseInstance,window.checkFirebaseConnection=checkFirebaseConnection,window.formatNumber=formatNumber,window.showToast=showToast,window.showLoadingSpinner=showLoadingSpinner,window.hideLoadingSpinner=hideLoadingSpinner,window.isValidEmail=isValidEmail,window.isValidPhone=isValidPhone;let app,auth,db,currentUser=null,isGuest=!1,isAdmin=!1,isLoading=!1,appInitialized=!1,cartItems=[],favorites=[],allProducts=[],siteCurrency="SDG ",siteSettings={},selectedProductForQuantity=null,directPurchaseItem=null,lastScrollTop=0;function hideLoader(){console.log("ğŸ”„ Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...");const e=document.getElementById("initialLoader");e&&"none"!==e.style.display&&(e.style.transition="opacity 0.5s ease",e.style.opacity="0",setTimeout(()=>{e.style.display="none",console.log("âœ… ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„")},500)),isLoading=!1}function forceHideLoader(){console.log("â±ï¸ Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ§Ù‹...");const e=document.getElementById("initialLoader");e&&(e.style.opacity="0",setTimeout(()=>{e.style.display="none"},100)),isLoading=!1}function checkFirebaseSDK(){if(!window.firebaseModules){console.error("âŒ Firebase SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡"),forceHideLoader();const e=document.getElementById("initialLoader");return e&&(e.innerHTML='\n                <div style="text-align: center; padding: 30px;">\n                    <i class="fas fa-exclamation-triangle fa-3x" style="color: #f39c12; margin-bottom: 20px;"></i>\n                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</h3>\n                    <p style="color: var(--gray-color); margin-bottom: 20px;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©. ÙŠØ±Ø¬Ù‰:</p>\n                    <div style="display: flex; gap: 10px; justify-content: center;">\n                        <button onclick="window.location.reload()" style="padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-family: \'Cairo\';">\n                            <i class="fas fa-redo"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©\n                        </button>\n                        <button onclick="signInAsGuest()" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-family: \'Cairo\';">\n                            <i class="fas fa-user"></i> Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ\n                        </button>\n                    </div>\n                </div>\n            '),!1}return!0}function initializeFirebase(){if(app&&auth&&db&&firebaseStorage)return console.log("âš ï¸ Firebase Ù…Ù‡ÙŠØ£ Ø¨Ø§Ù„ÙØ¹Ù„"),{app:app,auth:auth,db:db,storage:firebaseStorage};try{return console.log("ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase..."),app=window.firebaseModules.initializeApp(firebaseConfig,"MainApp"),auth=window.firebaseModules.getAuth(app),db=window.firebaseModules.getFirestore(app),firebaseStorage=window.firebaseModules.getStorage(app),console.log("âœ… Firebase Ù…Ù‡ÙŠØ£ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Storage"),{app:app,auth:auth,db:db,storage:firebaseStorage}}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:",e);try{return app=window.firebaseModules.getApp("MainApp"),auth=window.firebaseModules.getAuth(app),db=window.firebaseModules.getFirestore(app),firebaseStorage=window.firebaseModules.getStorage(app),console.log("âœ… ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…Ø«ÙŠÙ„ Firebase Ø§Ù„Ø­Ø§Ù„ÙŠ"),{app:app,auth:auth,db:db,storage:firebaseStorage}}catch(e){return console.error("âŒ ÙØ´Ù„ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…Ø«ÙŠÙ„ Firebase"),null}}}async function checkDatabaseConnection(){try{if(!db){console.log("ğŸ”„ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");if(!initializeFirebase())throw new Error("ØªØ¹Ø°Ø± ØªÙ‡ÙŠØ¦Ø© Firebase");return!0}const e=window.firebaseModules.collection(db,"settings");await window.firebaseModules.getDocs(e);return console.log("âœ… Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø´Ø·"),!0}catch(e){return console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e),!1}}async function initializeAppSafely(){if(appInitialized)console.log("âš ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù‡ÙŠØ£ Ø¨Ø§Ù„ÙØ¹Ù„");else if(console.log("ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†..."),appInitialized=!0,checkFirebaseSDK()){if(!initializeFirebase())return forceHideLoader(),showAuthScreen(),void showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ.","warning");try{await Promise.all([loadSiteConfig(),loadThemeColors()]),setupAllEventListeners(),setupRegistrationEventListeners(),setupSmartHeader();const e=window.firebaseModules.onAuthStateChanged(auth,async e=>{console.log("ğŸ”„ ØªØºÙŠØ±Øª Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:",e?"Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„":"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…"),await handleAuthStateChange(e)},e=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:",e),handleAuthError()});window.authUnsubscribe=e}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:",e),forceHideLoader(),showAuthScreen(),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.","error")}}}async function handleAuthStateChange(e){try{if(e)currentUser=e,isGuest=!1,await checkAdminPermissions(e.uid),await syncUserDataFromFirestore(),showMainApp(),showSection("home"),updateUserProfile(),await loadProducts(),updateCartCount(),updateAdminButton(),showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${e.displayName||"Ù…Ø³ØªØ®Ø¯Ù…"}!`,"success");else{const e=localStorage.getItem("currentUser");if(e)try{const t=JSON.parse(e);t.isGuest?(currentUser=t,isGuest=!0,isAdmin=!1,showMainApp(),showSection("home"),updateUserProfile(),await loadProducts(),updateCartCount(),updateAdminButton(),console.log("ğŸ‘¤ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¶ÙŠÙ")):showAuthScreen()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e),localStorage.removeItem("currentUser"),showAuthScreen()}else showAuthScreen()}hideLoader()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:",e),hideLoader(),showAuthScreen()}}function handleAuthError(){console.log("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ØµØ§Ø¯Ù‚Ø© Firebase");const e=localStorage.getItem("currentUser");if(e)try{const t=JSON.parse(e);if(t.isGuest)return currentUser=t,isGuest=!0,isAdmin=!1,showMainApp(),showSection("home"),updateUserProfile(),loadProducts(),updateCartCount(),updateAdminButton(),showToast("ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„","warning"),void hideLoader()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e)}forceHideLoader(),showAuthScreen(),showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ.","warning")}function signInAsGuest(){console.log("ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ..."),localStorage.removeItem("currentUser"),currentUser={uid:generateGuestUID(),displayName:"Ø²Ø§Ø¦Ø±",email:null,photoURL:"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",isGuest:!0},isGuest=!0,isAdmin=!1,localStorage.setItem("currentUser",JSON.stringify(currentUser)),updateAdminButton(),showMainApp(),showSection("home"),updateUserProfile(),loadProducts(),updateCartCount(),showToast("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø²Ø§Ø¦Ø±! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†","success"),hideLoader()}async function signInWithGoogle(){try{if(console.log("ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google..."),!checkFirebaseSDK()||!initializeFirebase())return void showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©","error");const e=new window.firebaseModules.GoogleAuthProvider,t=await window.firebaseModules.signInWithPopup(auth,e);currentUser=t.user,isGuest=!1,await checkAndCreateUserInFirestore(currentUser),await checkAdminPermissions(currentUser.uid),localStorage.setItem("currentUser",JSON.stringify({uid:currentUser.uid,displayName:currentUser.displayName,email:currentUser.email,photoURL:currentUser.photoURL,isGuest:!1,isAdmin:isAdmin})),showMainApp(),showSection("home"),updateUserProfile(),await loadProducts(),updateCartCount(),showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${currentUser.displayName}!`,"success")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„","error")}}function validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function clearRegistrationForm(){document.getElementById("registerName").value="",document.getElementById("registerEmail").value="",document.getElementById("registerPassword").value="",document.getElementById("registerPhone").value="";const e=document.getElementById("emailAuthMessage");e&&(e.textContent="",e.className="auth-message")}async function signUpWithEmail(e,t,o,n=""){try{if(console.log("ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯..."),!e||!t||!o)return showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©","warning"),!1;if(t.length<6)return showToast("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„","warning"),!1;if(!validateEmail(e))return showToast("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­","warning"),!1;if(!checkFirebaseSDK()||!initializeFirebase())return showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„","error"),!1;const s=await window.firebaseModules.createUserWithEmailAndPassword(auth,e,t);await window.firebaseModules.updateProfile(s.user,{displayName:o,photoURL:"https://cdn-icons-png.flaticon.com/512/3135/3135715.png"}),currentUser=s.user,isGuest=!1,isAdmin=!1;const i={email:e,name:o,phone:n,address:"",photoURL:"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",role:"user",isAdmin:!1,isGuest:!1,isActive:!0,totalOrders:0,totalSpent:0,favorites:[],createdAt:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()},r=window.firebaseModules.doc(db,"users",currentUser.uid);return await window.firebaseModules.setDoc(r,i),console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),console.log("User data saved to memory and Firestore"),showMainApp(),showSection("home"),updateUserProfile(),await loadProducts(),updateCartCount(),updateAdminButton(),showToast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ${o}!`,"success"),hideEmailAuthForm(),clearRegistrationForm(),!0}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:",e);let t="Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨";switch(e.code){case"auth/email-already-in-use":t="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„";break;case"auth/invalid-email":t="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­";break;case"auth/operation-not-allowed":t="Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­Ø©";break;case"auth/weak-password":t="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹";break;case"auth/network-request-failed":t="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©"}return showToast(t,"error"),!1}}async function signInWithEmail(e,t){try{if(console.log("ğŸ“§ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯..."),!checkFirebaseSDK()||!initializeFirebase())return void showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©","error");const o=await window.firebaseModules.signInWithEmailAndPassword(auth,e,t);currentUser=o.user,isGuest=!1,await checkAndUpdateUserInFirestore(currentUser),await checkAdminPermissions(currentUser.uid),localStorage.setItem("currentUser",JSON.stringify({uid:currentUser.uid,displayName:currentUser.displayName||currentUser.email.split("@")[0],email:currentUser.email,photoURL:currentUser.photoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",isGuest:!1,isAdmin:isAdmin})),showMainApp(),showSection("home"),updateUserProfile(),await loadProducts(),updateCartCount(),updateAdminButton(),showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${currentUser.displayName}!`,"success"),hideEmailAuthForm()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:",e);let t="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";switch(e.code){case"auth/user-not-found":t="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";break;case"auth/wrong-password":t="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";break;case"auth/invalid-email":t="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­";break;case"auth/user-disabled":t="ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨";break;case"auth/network-request-failed":t="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©"}showToast(t,"error")}}async function checkAndUpdateUserInFirestore(e){try{if(!db)return;const t=window.firebaseModules.doc(db,"users",e.uid);if((await window.firebaseModules.getDoc(t)).exists())await window.firebaseModules.updateDoc(t,{lastLogin:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()});else{const o={email:e.email,name:e.displayName||e.email.split("@")[0],phone:"",address:"",photoURL:e.photoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",role:"user",isAdmin:!1,isGuest:!1,isActive:!0,totalOrders:0,totalSpent:0,favorites:[],createdAt:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()};await window.firebaseModules.setDoc(t,o)}}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e)}}async function checkAndCreateUserInFirestore(e){try{if(!db)return;(await window.firebaseModules.getDoc(window.firebaseModules.doc(db,"users",e.uid))).exists()||await window.firebaseModules.setDoc(window.firebaseModules.doc(db,"users",e.uid),{email:e.email,name:e.displayName||e.email.split("@")[0],phone:"",address:"",photoURL:e.photoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",role:"user",isAdmin:!1,isGuest:!1,totalOrders:0,totalSpent:0,favorites:[],createdAt:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()})}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e)}}async function checkAdminPermissions(e){console.log("ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e);try{if(!db)return isAdmin=!1,console.log("âŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©"),!1;const t=window.firebaseModules.doc(db,"users",e),o=await window.firebaseModules.getDoc(t);if(o.exists()){const e=o.data();!0===e.isAdmin||"admin"===e.role?(isAdmin=!0,console.log("âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù†")):(isAdmin=!1,console.log("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙŠØ³ Ø£Ø¯Ù…Ù†"))}else console.log("âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),isAdmin=!1;return updateAdminButton(),isAdmin}catch(e){return console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e),isAdmin=!1,updateAdminButton(),!1}}function updateAdminButton(){const e=document.getElementById("adminBtn"),t=document.getElementById("adminMobileLink");e&&(e.style.display=isAdmin&&!isGuest?"flex":"none"),t&&(t.style.display=isAdmin&&!isGuest?"block":"none")}async function signOutUser(){console.log("ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...");try{if(isGuest&&!confirm("Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"))return;!isGuest&&auth&&await window.firebaseModules.signOut(auth),console.log("User signed out, memory cleared"),currentUser=null,isGuest=!1,isAdmin=!1,cartItems=[],favorites=[],window.authUnsubscribe&&window.authUnsubscribe(),updateAdminButton(),updateCartCount(),showAuthScreen(),showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­","success")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬","error")}}async function loadThemeColors(){try{if(!db)return;const e=window.firebaseModules.doc(db,"settings","theme_colors"),t=await window.firebaseModules.getDoc(e);if(t.exists()){applyThemeColors(t.data())}}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",e)}}function applyThemeColors(e){const t=document.documentElement;e.primaryColor&&t.style.setProperty("--primary-color",e.primaryColor),e.secondaryColor&&t.style.setProperty("--secondary-color",e.secondaryColor),e.successColor&&t.style.setProperty("--success-color",e.successColor),e.dangerColor&&t.style.setProperty("--danger-color",e.dangerColor),e.warningColor&&t.style.setProperty("--warning-color",e.warningColor),e.lightColor&&t.style.setProperty("--light-color",e.lightColor),e.buttonPressColor&&t.style.setProperty("--button-press-color",e.buttonPressColor)}async function loadProducts(){if(console.log("ğŸ›ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase..."),isLoading)console.log("âš ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ØªØ®Ø·ÙŠ...");else{isLoading=!0;try{if(!db)return console.log("âŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©"),void displayNoProductsMessage();const e=window.firebaseModules.collection(db,"products"),t=window.firebaseModules.query(e,window.firebaseModules.where("isActive","==",!0)),o=await window.firebaseModules.getDocs(t);if(o.empty)return console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"),void displayNoProductsMessage();allProducts=o.docs.map(e=>{const t=e.data();return{id:e.id,name:t.name||"Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…",price:t.price||0,originalPrice:t.originalPrice||null,image:t.image||"https://via.placeholder.com/300x200?text=ØµÙˆØ±Ø©",category:t.category||"ØºÙŠØ± Ù…ØµÙ†Ù",stock:t.stock||0,description:t.description||"",isNew:t.isNew||!1,isSale:t.isSale||!1,isBest:t.isBest||!1,isActive:!1!==t.isActive,createdAt:t.createdAt?.toDate?t.createdAt.toDate():new Date}}),console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allProducts.length} Ù…Ù†ØªØ¬ Ù…Ù† Firebase`),displayProducts(),displayFeaturedProducts()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase:",e),displayNoProductsMessage()}finally{isLoading=!1}}}function displayNoProductsMessage(){const e=document.getElementById("productsGrid"),t=document.getElementById("featuredProductsGrid"),o='\n        <div style="text-align: center; padding: 40px 20px; width: 100%;">\n            <i class="fas fa-box-open fa-3x" style="color: var(--gray-color); margin-bottom: 20px;"></i>\n            <h3 style="color: var(--primary-color); margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©</h3>\n            <p style="color: var(--gray-color);">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>\n        </div>\n    ';e&&(e.innerHTML=o),t&&(t.innerHTML=o)}function displayProducts(e=allProducts){const t=document.getElementById("productsGrid");t&&(0!==e.length?t.innerHTML=e.map(e=>{const t=!0===e.isNew||"true"===e.isNew,o=!0===e.isSale||"true"===e.isSale,n=!0===e.isBest||"true"===e.isBest,s=favorites.some(t=>t.id===e.id);return`\n            <div class="product-card" data-id="${e.id}">\n                <div class="product-image">\n                    <img src="${e.image}" alt="${e.name}" onerror="this.src='https://via.placeholder.com/300x200?text=ØµÙˆØ±Ø©'">\n                    ${t?'<div class="badge new">Ø¬Ø¯ÙŠØ¯</div>':""}\n                    ${o?'<div class="badge sale">Ø¹Ø±Ø¶</div>':""}\n                    ${n?'<div class="badge best">Ø§Ù„Ø£ÙØ¶Ù„</div>':""}\n                </div>\n                <div class="product-info">\n                    <h3>${e.name}</h3>\n                    <p class="product-description">${e.description||""}</p>\n                    <div class="product-price">\n                        <span class="current-price">${formatNumber(e.price)} ${siteCurrency}</span>\n                        ${e.originalPrice?`<span class="original-price">${formatNumber(e.originalPrice)} ${siteCurrency}</span>`:""}\n                    </div>\n                    <div class="product-stock">\n                        <i class="fas fa-box"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${formatNumber(e.stock||0)}\n                    </div>\n                    <div class="product-actions">\n                        <button class="action-btn add-to-cart" onclick="openQuantityModal('${e.id}')">\n                            <i class="fas fa-shopping-bag"></i> Ø´Ø±Ø§Ø¡\n                        </button>\n                        <button class="action-btn favorite-btn ${s?"active":""}" onclick="toggleFavorite('${e.id}')">\n                            <i class="fas fa-heart"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `}).join(""):displayNoProductsMessage())}function displayFeaturedProducts(e=null){const t=document.getElementById("featuredProductsGrid");if(!t)return;const o=e||allProducts;0!==o.length?t.innerHTML=o.map(e=>{const t=!0===e.isNew||"true"===e.isNew,o=!0===e.isSale||"true"===e.isSale,n=!0===e.isBest||"true"===e.isBest;return`\n            <div class="product-card" data-id="${e.id}">\n                <div class="product-image">\n                    <img src="${e.image}" alt="${e.name}" onerror="this.src='https://via.placeholder.com/300x200?text=ØµÙˆØ±Ø©'">\n                    ${t?'<div class="badge new">Ø¬Ø¯ÙŠØ¯</div>':""}\n                    ${o?'<div class="badge sale">Ø¹Ø±Ø¶</div>':""}\n                    ${n?'<div class="badge best">Ø§Ù„Ø£ÙØ¶Ù„</div>':""}\n                </div>\n                <div class="product-info">\n                    <h3>${e.name}</h3>\n                    <div class="product-price">\n                        <span class="current-price">${formatNumber(e.price)} ${siteCurrency}</span>\n                    </div>\n                    <div class="product-actions">\n                        <button class="action-btn add-to-cart" onclick="openQuantityModal('${e.id}')">\n                            <i class="fas fa-shopping-bag"></i> Ø´Ø±Ø§Ø¡\n                        </button>\n                        <button class="action-btn favorite-btn" onclick="toggleFavorite('${e.id}')">\n                            <i class="fas fa-heart"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `}).join(""):displayNoProductsMessage()}function filterMainProducts(e,t){let o;document.querySelectorAll(".filter-tab").forEach(e=>{e.style.background="white",e.style.color="black",e.style.borderColor="#ddd"}),t.style.background="var(--primary-color)",t.style.color="white",t.style.borderColor="var(--primary-color)",o="all"===e?allProducts:allProducts.filter(t=>!0===t[e]||"true"===t[e]),displayFeaturedProducts(o)}function openQuantityModal(e){const t=allProducts.find(t=>t.id===e);t?(selectedProductForQuantity=t,document.getElementById("quantityProductName").textContent=t.name,document.getElementById("selectedQuantity").value=1,document.getElementById("productModal").classList.add("active")):showToast("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯","error")}function closeQuantityModal(){document.getElementById("productModal").classList.remove("active"),selectedProductForQuantity=null}function addToCartFromModal(){if(!selectedProductForQuantity)return;const e=parseInt(document.getElementById("selectedQuantity").value)||1;addToCartWithQuantity(selectedProductForQuantity.id,e),closeQuantityModal()}function buyNowFromModal(){if(!selectedProductForQuantity)return;const e=parseInt(document.getElementById("selectedQuantity").value)||1;buyNowDirect(selectedProductForQuantity.id,e),closeQuantityModal()}function addToCartWithQuantity(e,t=1){const o=allProducts.find(t=>t.id===e);if(!o)return void showToast("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯","error");if(o.stock<=0)return void showToast("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†","warning");if(t>o.stock)return void showToast(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${o.stock}`,"warning");const n=cartItems.find(t=>t.id===e);if(n){if(n.quantity+t>o.stock)return void showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†. Ø§Ù„Ù…ØªØ§Ø­: "+(o.stock-n.quantity),"warning");n.quantity+=t}else cartItems.push({id:o.id,name:o.name,price:o.price,originalPrice:o.originalPrice,image:o.image,quantity:t,stock:o.stock});localStorage.setItem("cart",JSON.stringify(cartItems)),updateCartCount();const s=document.getElementById("cart");s&&s.classList.contains("active")&&updateCartDisplay(),showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${t} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©`,"success")}function updateCartCount(){const e=cartItems.reduce((e,t)=>e+t.quantity,0);document.querySelectorAll(".cart-count").forEach(t=>{t.textContent=e})}function updateCartDisplay(){const e=document.getElementById("cartItems"),t=document.getElementById("emptyCartMessage"),o=document.querySelector(".cart-summary");if(e&&t){if(0===cartItems.length)return e.style.display="none",t.style.display="block",void(o&&(o.style.display="none"));e.style.display="flex",e.style.flexDirection="column",t.style.display="none",o&&(o.style.display="block"),e.innerHTML=cartItems.map(e=>{const t=e.price*e.quantity;return`\n            <div class="cart-item">\n                <div class="cart-item-image">\n                    <img src="${e.image}" alt="${e.name}" onerror="this.src='https://via.placeholder.com/100x100?text=ØµÙˆØ±Ø©'">\n                </div>\n                <div class="cart-item-details">\n                    <h3 class="cart-item-title">${e.name}</h3>\n                    <p class="cart-item-price">${e.price} ${siteCurrency}</p>\n                    <div class="cart-item-controls">\n                        <div class="quantity-controls">\n                            <button class="quantity-btn" onclick="updateCartQuantity('${e.id}', -1)">\n                                <i class="fas fa-minus"></i>\n                            </button>\n                            <span class="quantity">${e.quantity}</span>\n                            <button class="quantity-btn" onclick="updateCartQuantity('${e.id}', 1)">\n                                <i class="fas fa-plus"></i>\n                            </button>\n                        </div>\n                        <button class="remove-item-btn" onclick="removeFromCart('${e.id}')">\n                            <i class="fas fa-trash"></i> Ø­Ø°Ù\n                        </button>\n                    </div>\n                    <p class="cart-item-total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${t} ${siteCurrency}</p>\n                </div>\n            </div>\n        `}).join(""),updateCartSummary()}}function updateCartQuantity(e,t){const o=cartItems.find(t=>t.id===e);if(!o)return;const n=allProducts.find(t=>t.id===e),s=o.quantity+t;s<1?removeFromCart(e):s>(n?.stock||o.stock||99)?showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†","warning"):(o.quantity=s,localStorage.setItem("cart",JSON.stringify(cartItems)),updateCartCount(),updateCartDisplay())}function removeFromCart(e){confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ")&&(cartItems=cartItems.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(cartItems)),updateCartCount(),updateCartDisplay(),showToast("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©","info"))}function updateCartSummary(){const e=cartItems.reduce((e,t)=>e+t.price*t.quantity,0),t=siteSettings.shippingCost||15,o=siteSettings.freeShippingLimit||200;let n=0;e>0&&e<o&&(n=t);const s=e+n,i=document.getElementById("cartSubtotal"),r=document.getElementById("shippingCost"),a=document.getElementById("totalAmount"),d=document.getElementById("shippingNote"),c=document.getElementById("checkoutBtn");if(i&&(i.textContent=`${formatNumber(e)} ${siteCurrency}`),r&&(r.textContent=`${formatNumber(n)} ${siteCurrency}`),a&&(a.textContent=`${formatNumber(s)} ${siteCurrency}`),d)if(e>0&&e<o){const t=o-e;d.innerHTML=`\n                <i class="fas fa-truck"></i>\n                Ø£Ø¶Ù ${t} ${siteCurrency} Ø£Ø®Ø±Ù‰ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ\n            `}else d.innerHTML=e>=o?'\n                <i class="fas fa-check-circle"></i>\n                Ø§Ù„Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ\n            ':"";c&&(c.disabled=0===e)}function clearCart(){0!==cartItems.length&&confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")&&(cartItems=[],localStorage.removeItem("cart"),updateCartCount(),updateCartDisplay(),showToast("ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©","info"))}function previewReceipt(e){const t=document.getElementById("receiptPreviewContainer"),o=document.getElementById("receiptPreviewImg"),n=document.getElementById("confirmOrderBtn"),s=document.getElementById("uploadPlaceholder"),i=document.getElementById("uploadProgress"),r=document.querySelector(".receipt-upload-container");if(!e.files||!e.files[0])return;const a=e.files[0];try{if(a.size>10485760)return showToast("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB","error"),void(e.value="");if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type.toLowerCase()))return showToast("Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø©","error"),void(e.value="");const d=new FileReader;d.onload=function(e){o.src=e.target.result,t.style.display="block",s&&(s.style.display="none"),r&&(r.style.borderStyle="solid",r.style.borderColor="#27ae60",r.style.background="#f0fff4"),n&&(n.disabled=!1,n.style.opacity="1",n.innerHTML='<i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†'),i&&(i.style.display="none")},d.readAsDataURL(a)}catch(t){console.error("Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©:",t),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©","error"),e.value=""}}async function uploadReceiptImage(e){try{if(!e)throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù");const t=10485760;if(e.size>t)throw new Error(`Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${t/1024/1024}MB`);if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type.toLowerCase()))throw new Error("Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© (JPG, PNG, WebP, GIF)");const o=Date.now(),n=`receipt_${o}_${Math.random().toString(36).substring(2,15)}_${e.name.replace(/[^a-zA-Z0-9.]/g,"_")}`;if(!firebaseStorage){const e=initializeFirebase();if(!e||!e.storage)throw new Error("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†");firebaseStorage=e.storage}const s=window.firebaseModules.ref(firebaseStorage,`receipts/${n}`),i=document.getElementById("uploadProgress"),r=document.getElementById("progressFill"),a=document.getElementById("progressText");i&&(i.style.display="block");const d=window.firebaseModules.uploadBytesResumable(s,e);return new Promise((t,o)=>{d.on("state_changed",e=>{const t=e.bytesTransferred/e.totalBytes*100;r&&(r.style.width=t+"%"),a&&(a.textContent=Math.round(t)+"%")},e=>{console.error("âŒ Upload error:",e),o(e)},async()=>{try{const o=await window.firebaseModules.getDownloadURL(d.snapshot.ref);console.log("âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­:",o),t({url:o,name:n,size:e.size,type:e.type,uploadedAt:(new Date).toISOString()})}catch(e){o(e)}})})}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:",e);let t="ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„";throw"storage/unauthorized"===e.code?t="Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª":"storage/canceled"===e.code?t="ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹":"storage/unknown"===e.code?t="Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ÙÙŠ Ø§Ù„Ø±ÙØ¹":e.message.includes("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù")||e.message.includes("Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù")?t=e.message:e.message.includes("network")&&(t="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©"),showToast(t,"error"),e}}function removeReceiptPreview(){const e=document.getElementById("receiptInput"),t=document.getElementById("receiptPreviewContainer"),o=document.getElementById("receiptPreviewImg"),n=document.getElementById("confirmOrderBtn"),s=document.getElementById("uploadPlaceholder"),i=document.querySelector(".receipt-upload-container");e&&(e.value=""),t&&(t.style.display="none"),o&&(o.src=""),s&&(s.style.display="block"),i&&(i.style.borderStyle="dashed",i.style.borderColor="#ddd",i.style.background="#f9f9f9"),n&&(n.disabled=!0,n.innerHTML='<i class="fas fa-credit-card"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„')}async function validateOrderBeforeSubmit(){if(!await checkDatabaseConnection())return showToast("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰","error"),!1;if(!directPurchaseItem&&0===cartItems.length)return showToast("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©","warning"),!1;const e=document.getElementById("orderPhone")?.value.trim();if(!e)return showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ","warning"),!1;if(!isValidPhone(e))return showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­","warning"),!1;const t=document.getElementById("receiptInput")?.files[0];if(!t)return showToast("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„","warning"),!1;if(!firebaseStorage){const e=initializeFirebase();if(!e||!e.storage)return showToast("ØªØ¹Ø°Ø± ØªÙ‡ÙŠØ¦Ø© Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†","error"),!1;firebaseStorage=e.storage}return!0}async function confirmOrder(){if(!await validateOrderBeforeSubmit())return;const e=document.getElementById("confirmOrderBtn"),t=document.getElementById("orderPhone").value.trim(),o=document.getElementById("orderAddress").value.trim(),n=document.getElementById("orderNotes").value.trim(),s=document.getElementById("receiptInput").files[0];e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...',e.disabled=!0;try{if(!(db&&firebaseStorage||initializeFirebase()))throw new Error("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");let e=null;if(!s)throw new Error("Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„");showToast("Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„...","info"),e=await uploadReceiptImage(s);const i=directPurchaseItem?[directPurchaseItem]:cartItems,r=i.reduce((e,t)=>e+t.price*t.quantity,0),a=r<(siteSettings.freeShippingLimit||200)?siteSettings.shippingCost||15:0,d=r+a;let c=11001e3;try{const e=window.firebaseModules.doc(db,"settings","site_config"),t=await window.firebaseModules.getDoc(e);if(t.exists()){const e=t.data();e.lastOrderNumber&&e.lastOrderNumber>=11001e3&&(c=e.lastOrderNumber+1)}await window.firebaseModules.updateDoc(e,{lastOrderNumber:c,updatedAt:window.firebaseModules.serverTimestamp()})}catch(e){console.error("Error updating order number:",e),c=11001e3+Math.floor(1e3*Math.random())}const l="NO:"+c,u={orderId:l,orderNumber:c,userId:currentUser?.uid||"guest",customerName:currentUser?.displayName||currentUser?.name||"Ù…Ø³ØªØ®Ø¯Ù…",customerEmail:currentUser?.email||"",customerPhone:t||currentUser?.phone||"",address:o||"",notes:n,items:i.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.image,total:e.price*e.quantity})),subtotal:r,shippingCost:a,total:d,status:"pending",paymentMethod:"bank_transfer",receiptImage:e.url,receiptFileName:e.name,receiptFileType:e.type,receiptFileSize:e.size,receiptUploadDate:e.uploadedAt,createdAt:(new Date).toISOString(),firestoreTimestamp:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()};console.log("ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Firebase:",u);const m=window.firebaseModules.collection(db,"orders");if(await window.firebaseModules.addDoc(m,u),console.log("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­:",l),!isGuest&&currentUser?.uid)try{const e=window.firebaseModules.doc(db,"users",currentUser.uid);await window.firebaseModules.updateDoc(e,{totalOrders:window.firebaseModules.increment(1),totalSpent:window.firebaseModules.increment(d),lastOrderDate:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()}),console.log("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")}catch(e){console.error("âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e)}if(isGuest){const e=JSON.parse(localStorage.getItem("guest_orders"))||[];e.push(u),localStorage.setItem("guest_orders",JSON.stringify(e))}await sendAdminOrderNotification(u),directPurchaseItem?directPurchaseItem=null:(cartItems=[],localStorage.removeItem("cart"),updateCartCount()),closeCheckoutModal(),showSuccessOrderMessage(l),document.getElementById("my-orders").classList.contains("active")&&setTimeout(()=>loadMyOrders(),1e3),showToast(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${l}`,"success")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:",e);let t="Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";e.message.includes("permission")?t="Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù….":e.message.includes("network")?t="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.":e.message.includes("database")?t="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.":e.message.includes("storage")&&(t="Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),showToast(`${t}: ${e.message}`,"error")}finally{e.innerHTML='<i class="fas fa-credit-card"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„',e.disabled=!1;const t=document.getElementById("uploadProgress");t&&(t.style.display="none")}}async function sendAdminOrderNotification(e){try{if(!db)return;const t=window.firebaseModules.collection(db,"notifications");await window.firebaseModules.addDoc(t,{type:"new_order",title:"Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!",message:`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${e.orderId} Ù…Ù† ${e.customerName} Ø¨Ù‚ÙŠÙ…Ø© ${formatNumber(e.total)} ${siteCurrency}`,orderId:e.orderId,orderData:{customerName:e.customerName,total:e.total,itemsCount:e.items.length,status:e.status},read:!1,priority:"high",createdAt:window.firebaseModules.serverTimestamp()}),console.log("ğŸ”” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø¯ÙŠØ±")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨:",e)}}function showSuccessOrderMessage(e){const t=`\n        <div style="text-align: center; padding: 40px 20px;">\n            <i class="fas fa-check-circle" style="color: var(--success-color); font-size: 60px; margin-bottom: 20px;"></i>\n            <h3 style="color: var(--primary-color); margin-bottom: 15px;">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>\n            <div style="background: var(--light-color); padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid var(--border-color);">\n                <p style="margin-bottom: 10px;"><strong>Ø±Ù‚Ù… Ø·Ù„Ø¨Ùƒ:</strong></p>\n                <h2 style="color: var(--secondary-color); margin: 0;">${e}</h2>\n            </div>\n            <p style="color: var(--gray-color); margin-bottom: 20px; line-height: 1.6;">\n                <i class="fas fa-info-circle"></i>\n                ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.<br>\n                Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.\n            </p>\n            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">\n                <button onclick="showSection('my-orders')" class="btn-primary" style="padding: 12px 25px;">\n                    <i class="fas fa-clipboard-list"></i> Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ\n                </button>\n                <button onclick="showSection('products')" class="btn-secondary" style="padding: 12px 25px;">\n                    <i class="fas fa-shopping-bag"></i> Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ØªØ³ÙˆÙ‚\n                </button>\n            </div>\n        </div>\n    `,o=document.getElementById("cart");if(o){const e=o.innerHTML;o.innerHTML=t,setTimeout(()=>{o.innerHTML=e,updateCartDisplay()},15e3)}}async function loadMyOrders(){const e=document.getElementById("myOrdersList"),t=document.getElementById("emptyOrdersMessage");if(e){if(isGuest){const o=JSON.parse(localStorage.getItem("guest_orders"))||[];if(0===o.length)return e.innerHTML="",void(t.style.display="block");let n="";return o.forEach(e=>{const t=e.createdAt?new Date(e.createdAt).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",o={pending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",paid:"ØªÙ… Ø§Ù„Ø¯ÙØ¹",processing:"ÙŠØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²",shipped:"ØªÙ… Ø§Ù„Ø´Ø­Ù†",delivered:"ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„"}[e.status]||e.status,s={pending:"status-pending",paid:"status-processing",processing:"status-processing",shipped:"status-shipped",delivered:"status-delivered"}[e.status]||"status-pending",i=e.receiptImage;n+=`\n                <div class="order-card">\n                    <div class="order-header">\n                        <div>\n                            <span class="order-id">Ø·Ù„Ø¨ #${e.orderId||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</span>\n                            <span class="order-date">${t}</span>\n                        </div>\n                        <span class="order-status-badge ${s}">${o}</span>\n                    </div>\n                    <div class="order-body">\n                        <div class="order-info">\n                            <h5>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h5>\n                            <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${e.address||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n                            ${e.notes?`<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${e.notes}</p>`:""}\n                            <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</p>\n                            ${i?'\n                                <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:</strong> <span style="color: var(--success-color);">âœ“ Ù…Ø±ÙÙ‚</span></p>\n                            ':""}\n                        </div>\n                        <div class="order-items">\n                            <h5>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${e.items?.length||0})</h5>\n                            ${(e.items||[]).map(e=>`\n                                <div class="order-item-row">\n                                    <span>${e.name||"Ù…Ù†ØªØ¬"} Ã— ${e.quantity||1}</span>\n                                    <span>${formatNumber(e.total||e.price||0)} ${siteCurrency}</span>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                    <div class="order-footer">\n                        <div class="order-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(e.total||0)} ${siteCurrency}</div>\n                        ${i?`\n                            <button onclick="viewReceipt('${i}')" class="btn-secondary" style="padding: 8px 15px; font-size: 14px;">\n                                <i class="fas fa-image"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            `}),e.innerHTML=n,void(t.style.display="none")}if(!currentUser)return e.innerHTML='\n            <div style="text-align: center; padding: 40px 20px;">\n                <i class="fas fa-user-clock fa-3x" style="color: var(--gray-color); margin-bottom: 20px;"></i>\n                <h3 style="color: var(--primary-color); margin-bottom: 10px;">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨</h3>\n                <p style="color: var(--gray-color); margin-bottom: 20px;">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>\n                <button onclick="showAuthScreen()" class="btn-primary" style="padding: 12px 25px;">\n                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„\n                </button>\n            </div>\n        ',void(t.style.display="none");e.innerHTML='<div class="spinner"></div>',t.style.display="none";try{const o=window.firebaseModules.collection(db,"orders"),n=window.firebaseModules.query(o,window.firebaseModules.where("userId","==",currentUser.uid)),s=await window.firebaseModules.getDocs(n);if(s.empty)return e.innerHTML="",void(t.style.display="block");let i="";const r=[];s.forEach(e=>{const t=e.data();t.id=e.id,r.push(t)}),r.sort((e,t)=>{let o,n;try{o=e.createdAt?.toDate?e.createdAt.toDate():e.createdAt?new Date(e.createdAt):new Date(0),n=t.createdAt?.toDate?t.createdAt.toDate():t.createdAt?new Date(t.createdAt):new Date(0)}catch(e){o=new Date(0),n=new Date(0)}return n-o}),r.forEach(e=>{let t="ØºÙŠØ± Ù…Ø­Ø¯Ø¯";try{if(e.createdAt)if(e.createdAt.toDate)t=e.createdAt.toDate().toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});else if(e.createdAt instanceof Date)t=e.createdAt.toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});else if("string"==typeof e.createdAt){t=new Date(e.createdAt).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}}catch(e){console.error("Error parsing date:",e)}const o={pending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",paid:"ØªÙ… Ø§Ù„Ø¯ÙØ¹",processing:"ÙŠØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²",shipped:"ØªÙ… Ø§Ù„Ø´Ø­Ù†",delivered:"ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„"}[e.status]||e.status,n={pending:"status-pending",paid:"status-processing",processing:"status-processing",shipped:"status-shipped",delivered:"status-delivered"}[e.status]||"status-pending",s=e.receiptImage||e.receiptUrl;i+=`\n                <div class="order-card">\n                    <div class="order-header">\n                        <div>\n                            <span class="order-id">Ø·Ù„Ø¨ #${e.orderId||e.id}</span>\n                            <span class="order-date">${t}</span>\n                        </div>\n                        <span class="order-status-badge ${n}">${o}</span>\n                    </div>\n                    <div class="order-body">\n                        <div class="order-info">\n                            <h5>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h5>\n                            <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${e.address||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n                            ${e.notes?`<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${e.notes}</p>`:""}\n                            <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong> ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</p>\n                            ${s?'\n                                <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:</strong> <span style="color: var(--success-color);">âœ“ Ù…Ø±ÙÙ‚</span></p>\n                            ':""}\n                        </div>\n                        <div class="order-items">\n                            <h5>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${e.items?.length||0})</h5>\n                            ${(e.items||[]).map(e=>`\n                                <div class="order-item-row">\n                                    <span>${e.name||"Ù…Ù†ØªØ¬"} Ã— ${e.quantity||1}</span>\n                                    <span>${formatNumber(e.total||e.price||0)} ${siteCurrency}</span>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                    <div class="order-footer">\n                        <div class="order-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(e.total||0)} ${siteCurrency}</div>\n                        ${s?`\n                            <button onclick="viewReceipt('${s}')" class="btn-secondary" style="padding: 8px 15px; font-size: 14px;">\n                                <i class="fas fa-image"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            `}),e.innerHTML=i,t.style.display="none"}catch(t){console.error("Error loading orders:",t),e.innerHTML=`\n            <div style="text-align: center; padding: 40px 20px; color: var(--danger-color);">\n                <i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 20px;"></i>\n                <h3>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>\n                <p>${t.message}</p>\n                <button onclick="loadMyOrders()" class="btn-primary" style="margin-top: 15px;">\n                    <i class="fas fa-redo"></i> Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n                </button>\n            </div>\n        `}}}function viewReceipt(e){if(!e)return void showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØµØ§Ù„ Ù…Ø±ÙÙ‚","warning");const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0,0,0,0.9);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 10000;\n        cursor: pointer;\n    ",t.innerHTML=`\n        <div style="position: relative; max-width: 90%; max-height: 90%;">\n            <img src="${e}" \n                 style="max-width: 100%; max-height: 80vh; border-radius: 10px; border: 2px solid white;"\n                 onerror="this.onerror=null; this.src='https://cdn-icons-png.flaticon.com/512/1178/1178479.png';">\n            <div style="position: absolute; bottom: -50px; left: 0; right: 0; text-align: center;">\n                <button onclick="downloadImage('${e}', 'Ø¥ÙŠØµØ§Ù„_Ø·Ù„Ø¨.jpg')" \n                        class="btn-primary" \n                        style="padding: 10px 20px; margin-right: 10px;">\n                    <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„\n                </button>\n                <button onclick="this.parentElement.parentElement.parentElement.remove()" \n                        class="btn-secondary" \n                        style="padding: 10px 20px;">\n                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚\n                </button>\n            </div>\n        </div>\n    `,t.addEventListener("click",e=>{e.target===t&&t.remove()}),document.body.appendChild(t)}function downloadImage(e,t){const o=document.createElement("a");o.href=e,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function buyNowDirect(e,t=1){const o=allProducts.find(t=>t.id===e);o?o.stock<=0?showToast("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†","warning"):t>o.stock?showToast(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${o.stock}`,"warning"):(directPurchaseItem={id:o.id,name:o.name,price:o.price,quantity:t,image:o.image},updateCartCount(),setTimeout(()=>{openCheckoutModal(!0)},100)):showToast("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯","error")}function toggleFavorite(e){const t=allProducts.find(t=>t.id===e);if(!t)return;const o=favorites.findIndex(t=>t.id===e);-1===o?(favorites.push({id:t.id,name:t.name,price:t.price,image:t.image,category:t.category}),showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©","success")):(favorites.splice(o,1),showToast("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©","info")),currentUser&&!isGuest&&saveUserDataToFirestore(),document.getElementById("favorites").classList.contains("active")&&updateFavoritesDisplay(),updateFavoriteIcons(),updateProfileStats()}function updateFavoriteIcons(){document.querySelectorAll(".favorite-btn").forEach(e=>{const t=e.getAttribute("onclick");if(!t)return;const o=t.match(/'([^']+)'/);if(!o)return;const n=o[1];favorites.some(e=>e.id===n)?e.classList.add("active"):e.classList.remove("active")})}function updateFavoritesDisplay(){const e=document.getElementById("favoritesGrid"),t=document.getElementById("emptyFavoritesMessage");if(e&&t){if(0===favorites.length)return e.style.display="none",void(t.style.display="block");e.style.display="grid",t.style.display="none",e.innerHTML=favorites.map(e=>`\n            <div class="product-card">\n                <div class="product-image">\n                    <img src="${e.image}" alt="${e.name}" onerror="this.src='https://via.placeholder.com/300x200?text=ØµÙˆØ±Ø©'">\n                </div>\n                <div class="product-info">\n                    <h3>${e.name}</h3>\n                    <div class="product-price">\n                        <span class="current-price">${formatNumber(e.price)} ${siteCurrency}</span>\n                    </div>\n                    <div class="product-actions">\n                        <button class="action-btn add-to-cart" onclick="openQuantityModal('${e.id}')" style="background: var(--secondary-color); color: white; border-color: var(--secondary-color);">\n                            <i class="fas fa-bolt"></i> Ø´Ø±Ø§Ø¡ Ù…Ø¨Ø§Ø´Ø±\n                        </button>\n                        <button class="action-btn favorite-btn active" onclick="toggleFavorite('${e.id}')">\n                            <i class="fas fa-heart"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `).join("")}}function performSearch(){const e=document.getElementById("searchInput");if(!e)return;const t=e.value.trim().toLowerCase();if(!t)return void displayProducts();displayFilteredProducts(allProducts.filter(e=>e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.category&&e.category.toLowerCase().includes(t))),showSection("products")}function filterProducts(){let e=[...allProducts];const t=document.getElementById("categoryFilter")?.value;t&&(e=e.filter(e=>e.category===t));const o=document.getElementById("sortFilter")?.value;"price-low"===o?e.sort((e,t)=>e.price-t.price):"price-high"===o?e.sort((e,t)=>t.price-e.price):"newest"===o&&e.sort((e,t)=>t.createdAt-e.createdAt);Array.from(document.querySelectorAll(".filter-btn.active")).forEach(t=>{const o=t.getAttribute("data-filter");"isNew"===o?e=e.filter(e=>!0===e.isNew||"true"===e.isNew):"isSale"===o?e=e.filter(e=>!0===e.isSale||"true"===e.isSale):"isBest"===o&&(e=e.filter(e=>!0===e.isBest||"true"===e.isBest))}),displayFilteredProducts(e)}function displayFilteredProducts(e){const t=document.getElementById("productsGrid");t&&(0!==e.length?t.innerHTML=e.map(e=>{const t=!0===e.isNew||"true"===e.isNew,o=!0===e.isSale||"true"===e.isSale,n=!0===e.isBest||"true"===e.isBest,s=favorites.some(t=>t.id===e.id);return`\n            <div class="product-card" data-id="${e.id}">\n                <div class="product-image">\n                    <img src="${e.image}" alt="${e.name}" onerror="this.src='https://via.placeholder.com/300x200?text=ØµÙˆØ±Ø©'">\n                    ${t?'<div class="badge new">Ø¬Ø¯ÙŠØ¯</div>':""}\n                    ${o?'<div class="badge sale">Ø¹Ø±Ø¶</div>':""}\n                    ${n?'<div class="badge best">Ø§Ù„Ø£ÙØ¶Ù„</div>':""}\n                </div>\n                <div class="product-info">\n                    <h3>${e.name}</h3>\n                    <p class="product-description">${e.description||""}</p>\n                    <div class="product-price">\n                        <span class="current-price">${formatNumber(e.price)} ${siteCurrency}</span>\n                        ${e.originalPrice?`<span class="original-price">${formatNumber(e.originalPrice)} ${siteCurrency}</span>`:""}\n                    </div>\n                    <div class="product-actions">\n                        <button class="action-btn add-to-cart" onclick="openQuantityModal('${e.id}')">\n                            <i class="fas fa-shopping-bag"></i> Ø´Ø±Ø§Ø¡\n                        </button>\n                        <button class="action-btn favorite-btn ${s?"active":""}" onclick="toggleFavorite('${e.id}')">\n                            <i class="fas fa-heart"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `}).join(""):t.innerHTML='<p class="no-products">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>')}function updateUserProfile(){if(!currentUser)return;const e=JSON.parse(localStorage.getItem("currentUser"))||{},t=currentUser.displayName||e.displayName||e.name||"Ø²Ø§Ø¦Ø±",o=currentUser.email||e.email||"Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨";if([{id:"profileName",text:t},{id:"mobileUserName",text:t},{id:"profileEmail",text:o},{id:"mobileUserEmail",text:o},{id:"detailName",text:t},{id:"detailEmail",text:o}].forEach(e=>{const t=document.getElementById(e.id);t&&(t.textContent=e.text)}),currentUser.photoURL){document.querySelectorAll("#profileImage, #mobileUserImage").forEach(e=>{e.src=currentUser.photoURL})}updateProfileStats()}async function updateProfileStats(){const e=favorites.length;document.getElementById("favoritesCount").textContent=e;let t=0,o=0;if(isGuest){const e=JSON.parse(localStorage.getItem("guest_orders"))||[];t=e.length,o=e.reduce((e,t)=>e+(t.total||0),0)}else if(db&&currentUser)try{const e=window.firebaseModules.doc(db,"users",currentUser.uid),n=await window.firebaseModules.getDoc(e);if(n.exists()){const e=n.data();t=e.totalOrders||0,o=e.totalSpent||0}}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",e)}document.getElementById("ordersCount").textContent=t,document.getElementById("totalSpent").textContent=o}function editProfile(){const e=document.getElementById("editProfileModal");e&&(document.getElementById("editName").value=currentUser?.displayName||"",document.getElementById("editPhone").value="",document.getElementById("editAddress").value="",e.classList.add("active"))}async function saveProfileChanges(){const e=document.getElementById("editName").value,t=document.getElementById("editPhone").value,o=document.getElementById("editAddress").value;if(e.trim())try{if(!isGuest&&currentUser&&db){await window.firebaseModules.updateProfile(currentUser,{displayName:e});const n=window.firebaseModules.doc(db,"users",currentUser.uid);await window.firebaseModules.updateDoc(n,{name:e,phone:t,address:o,updatedAt:window.firebaseModules.serverTimestamp()})}currentUser.displayName=e,localStorage.setItem("currentUser",JSON.stringify(currentUser)),updateUserProfile(),document.getElementById("editProfileModal").classList.remove("active"),showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­","success")}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ","error")}else showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…","warning")}async function loadSiteConfig(){try{if(!db)return;const e=window.firebaseModules.doc(db,"settings","site_config"),t=await window.firebaseModules.getDoc(e);t.exists()&&(siteSettings=t.data(),siteCurrency=siteSettings.currency||"SDG ",updateUIWithSettings())}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:",e)}}function updateUIWithSettings(){if(!siteSettings)return;if(siteSettings.storeName){document.getElementById("dynamicTitle").textContent=siteSettings.storeName+" - Ù…ØªØ¬Ø± Ø§Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„";[document.getElementById("siteStoreName"),document.getElementById("footerStoreName")].forEach(e=>{e&&(e.textContent=siteSettings.storeName)})}const e={footerEmail:"email",footerPhone:"phone",footerAddress:"address",footerHours:"workingHours"};for(const[t,o]of Object.entries(e)){const e=document.getElementById(t);e&&siteSettings[o]&&(e.textContent=siteSettings[o])}const t=document.getElementById("storeDescription");t&&siteSettings.aboutUs&&(t.textContent=siteSettings.aboutUs);const o=document.querySelector(".footer-social")||document.querySelector(".social-links");if(o){let e="";siteSettings.whatsappUrl&&(e+=`<a href="${siteSettings.whatsappUrl}" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>`),siteSettings.instagramUrl&&(e+=`<a href="${siteSettings.instagramUrl}" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>`),siteSettings.facebookUrl&&(e+=`<a href="${siteSettings.facebookUrl}" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a>`),siteSettings.tiktokUrl&&(e+=`<a href="${siteSettings.tiktokUrl}" target="_blank" title="TikTok"><i class="fab fa-tiktok"></i></a>`),e&&(o.innerHTML=e)}if(siteSettings.logoUrl){[document.getElementById("siteLogo"),document.getElementById("authLogo"),document.getElementById("footerLogo")].forEach(e=>{e&&(e.src=siteSettings.logoUrl)})}}function setupAllEventListeners(){console.log("âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«..."),setupAuthEventListeners(),setupNavigationEventListeners(),setupAppEventListeners(),setupModalEventListeners(),setupQuantityModalEvents(),setupCheckoutEventListeners(),console.log("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¬Ø§Ù‡Ø²Ø©")}function setupAuthEventListeners(){const e=document.getElementById("googleSignInBtn");e&&e.addEventListener("click",signInWithGoogle);const t=document.getElementById("emailSignInBtn");t&&t.addEventListener("click",showEmailAuthForm);const o=document.getElementById("guestSignInBtn");o&&o.addEventListener("click",signInAsGuest);const n=document.getElementById("backToAuthOptions");n&&n.addEventListener("click",hideEmailAuthForm);const s=document.getElementById("passwordInput");s&&s.addEventListener("keypress",e=>{if("Enter"===e.key){const e=document.getElementById("emailInput")?.value||"",t=s.value;e&&t&&signInWithEmail(e,t)}})}function setupNavigationEventListeners(){const e=document.getElementById("menuToggle"),t=document.getElementById("closeMenu"),o=document.getElementById("mobileNav"),n=document.getElementById("navOverlay"),s=()=>{o&&o.classList.add("active"),n&&n.classList.add("active"),document.body.classList.add("menu-open")},i=()=>{o&&o.classList.remove("active"),n&&n.classList.remove("active"),document.body.classList.remove("menu-open")};e&&e.addEventListener("click",s),t&&t.addEventListener("click",i),n&&n.addEventListener("click",i),document.querySelectorAll("a[data-section]").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();showSection(this.getAttribute("data-section")),i()})});const r=document.getElementById("mobileLogoutBtn");r&&r.addEventListener("click",e=>{e.preventDefault(),signOutUser(),i()})}function setupAppEventListeners(){const e={shopNowBtn:()=>showSection("products"),continueShoppingBtn:()=>showSection("products"),browseProductsBtn:()=>showSection("products"),homeBtn:()=>showSection("home"),cartBtn:()=>showSection("cart"),favoritesBtn:()=>showSection("favorites"),profileBtn:()=>showSection("profile"),logoutBtn:signOutUser,checkoutBtn:openCheckoutModal,confirmOrderBtn:confirmOrder,cancelCheckoutBtn:closeCheckoutModal,closeCheckoutModal:closeCheckoutModal,editProfileBtn:editProfile,saveProfileBtn:saveProfileChanges,clearCartBtn:clearCart,adminBtn:()=>{console.log("ğŸ› ï¸ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…..."),window.open("admin.html","_blank")}};for(const[t,o]of Object.entries(e)){const e=document.getElementById(t);e&&e.addEventListener("click",o)}const t=document.getElementById("searchBtn"),o=document.getElementById("searchInput");t&&o&&(t.addEventListener("click",performSearch),o.addEventListener("keypress",e=>{"Enter"===e.key&&performSearch()}));const n=document.getElementById("categoryFilter"),s=document.getElementById("sortFilter");n&&n.addEventListener("change",filterProducts),s&&s.addEventListener("change",filterProducts),document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("active"),filterProducts()})})}function setupModalEventListeners(){document.querySelectorAll(".close-modal, .btn-secondary.close-modal").forEach(e=>{e.addEventListener("click",function(){const e=this.closest(".modal");e&&(e.classList.remove("active"),"checkoutModal"===e.id&&"function"==typeof removeReceiptPreview&&removeReceiptPreview())})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",function(e){e.target===this&&this.classList.remove("active")})})}function setupQuantityModalEvents(){const e=document.getElementById("increaseQuantity");e&&e.addEventListener("click",()=>{const e=document.getElementById("selectedQuantity");let t=parseInt(e.value)||1;t<99&&(e.value=t+1)});const t=document.getElementById("decreaseQuantity");t&&t.addEventListener("click",()=>{const e=document.getElementById("selectedQuantity");let t=parseInt(e.value)||1;t>1&&(e.value=t-1)});const o=document.getElementById("selectedQuantity");o&&o.addEventListener("change",function(){let e=parseInt(this.value)||1;e<1&&(e=1),e>99&&(e=99),this.value=e});const n=document.getElementById("addToCartFromModal");n&&n.addEventListener("click",addToCartFromModal);const s=document.getElementById("buyNowFromModal");s&&s.addEventListener("click",buyNowFromModal)}function setupCheckoutEventListeners(){const e=document.getElementById("receiptInput");e&&e.addEventListener("change",function(){previewReceipt(this)});const t=document.getElementById("removeReceiptBtn");t&&t.addEventListener("click",removeReceiptPreview)}function setupRegistrationEventListeners(){const e=document.getElementById("signUpBtn");e&&e.addEventListener("click",showRegistrationForm);const t=document.getElementById("completeSignUpBtn");t&&t.addEventListener("click",handleRegistration);const o=document.getElementById("switchToLoginBtn");o&&o.addEventListener("click",showLoginForm);const n=document.getElementById("signInBtn");n&&n.addEventListener("click",handleLogin);const s=document.getElementById("registerPassword");s&&s.addEventListener("keypress",e=>{"Enter"===e.key&&handleRegistration()})}function showRegistrationForm(){const e=document.getElementById("emailAuthForm");if(e){const t=e.querySelector(".form-header h2");t&&(t.textContent="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯");const o=document.getElementById("loginFields"),n=document.getElementById("registerFields");o&&(o.style.display="none"),n&&(n.style.display="block"),e.style.display="block";const s=document.getElementById("registerName");s&&s.focus()}}function showLoginForm(){const e=document.getElementById("emailAuthForm");if(e){const t=e.querySelector(".form-header h2");t&&(t.textContent="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");const o=document.getElementById("loginFields"),n=document.getElementById("registerFields");o&&(o.style.display="block"),n&&(n.style.display="none");const s=document.getElementById("emailInput");s&&s.focus()}}async function handleRegistration(){const e=document.getElementById("registerName")?.value||"",t=document.getElementById("registerEmail")?.value||"",o=document.getElementById("registerPassword")?.value||"",n=document.getElementById("registerPhone")?.value||"";if(!e||!t||!o)return void showAuthMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©","error");if(o.length<6)return void showAuthMessage("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„","error");if(!validateEmail(t))return void showAuthMessage("Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­","error");showAuthMessage("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ...","info");await signUpWithEmail(t,o,e,n)&&showAuthMessage("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!","success")}async function handleLogin(){const e=document.getElementById("emailInput")?.value||"",t=document.getElementById("passwordInput")?.value||"";e&&t?(showAuthMessage("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...","info"),await signInWithEmail(e,t)):showAuthMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±","error")}function setupSmartHeader(){const e=document.querySelector(".header"),t=document.getElementById("backToTop");e&&(window.addEventListener("scroll",function(){let o=window.pageYOffset||document.documentElement.scrollTop;e.style.transform=o>lastScrollTop&&o>100?"translateY(-100%)":"translateY(0)",t&&(t.style.display=o>500?"block":"none"),lastScrollTop=o<=0?0:o},{passive:!0}),e.style.transition="transform 0.3s ease-in-out",t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function showAuthScreen(){const e=document.getElementById("authScreen"),t=document.getElementById("appContainer");e&&e.style.setProperty("display","flex","important"),t&&t.style.setProperty("display","none","important")}function showMainApp(){const e=document.getElementById("authScreen"),t=document.getElementById("appContainer");e&&e.style.setProperty("display","none","important"),t&&t.style.setProperty("display","flex","important")}function showEmailAuthForm(){const e=document.getElementById("emailAuthForm");e&&(e.style.display="block",showLoginForm())}function hideEmailAuthForm(){const e=document.getElementById("emailAuthForm");e&&(e.style.display="none",clearEmailForm())}function clearEmailForm(){const e=document.getElementById("emailInput"),t=document.getElementById("passwordInput"),o=document.getElementById("emailAuthMessage");e&&(e.value=""),t&&(t.value=""),o&&(o.textContent="",o.className="auth-message")}function showAuthMessage(e,t="error"){const o=document.getElementById("emailAuthMessage");o&&(o.textContent=e,o.className=`auth-message ${t}`)}function showSection(e){document.querySelectorAll(".section").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(e);if(t)switch(t.classList.add("active"),window.scrollTo({top:0,behavior:"smooth"}),e){case"cart":updateCartDisplay();break;case"favorites":updateFavoritesDisplay();break;case"profile":updateProfileStats();break;case"my-orders":loadMyOrders()}}function adjustLayout(){const e=document.querySelector(".header-content");e&&(e.style.display="grid",e.style.gridTemplateColumns="auto 1fr auto",e.style.alignItems="center",e.style.gap="15px",e.style.padding="15px 20px");const t=document.querySelector(".search-container");t&&(t.style.width="300px",t.style.margin="0");const o=document.querySelector(".products-grid");o&&(o.style.display="grid",o.style.gridTemplateColumns="repeat(auto-fill, minmax(280px, 1fr))",o.style.gap="25px",o.style.margin="0")}function openCheckoutModal(e=!1){if(isGuest)return showToast("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨","warning"),void showAuthScreen();if(!e&&0===cartItems.length)return void showToast("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©","warning");const t=(e?[directPurchaseItem]:cartItems).reduce((e,t)=>e+t.price*t.quantity,0),o=siteSettings.shippingCost||15,n=t+(t<(siteSettings.freeShippingLimit||200)?o:0);document.getElementById("checkoutTotalDisplay").textContent=`${formatNumber(n)} ${siteCurrency}`,document.getElementById("orderPhone")&&(document.getElementById("orderPhone").value=currentUser?.phone||""),document.getElementById("orderAddress").value=currentUser?.address||"",siteSettings.bankName&&(document.getElementById("displayBankName").textContent=siteSettings.bankName),siteSettings.bankAccount&&(document.getElementById("displayAccountNumber").textContent=siteSettings.bankAccount),siteSettings.bankAccountName&&(document.getElementById("displayAccountName").textContent=siteSettings.bankAccountName),document.getElementById("checkoutModal").classList.add("active")}function closeCheckoutModal(){document.getElementById("checkoutModal").classList.remove("active"),removeReceiptPreview()}async function syncUserDataFromFirestore(){if(currentUser&&!isGuest)try{const e=window.firebaseModules.doc(db,"users",currentUser.uid),t=await window.firebaseModules.getDoc(e);if(t.exists()){const e=t.data();cartItems=e.cart||[],favorites=e.favorites||[],console.log("âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©")}}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e)}}async function saveUserDataToFirestore(){if(currentUser&&!isGuest)try{const e=window.firebaseModules.doc(db,"users",currentUser.uid);await window.firebaseModules.updateDoc(e,{cart:cartItems,favorites:favorites,lastUpdated:window.firebaseModules.serverTimestamp()}),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e)}}setTimeout(forceHideLoader,8e3),document.addEventListener("DOMContentLoaded",function(){console.log("ğŸ“„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...");const e=document.getElementById("initialLoader");e&&(e.style.display="flex",e.style.opacity="1"),adjustLayout(),setTimeout(()=>{initializeAppSafely()},100)}),window.addEventListener("load",function(){console.log("ğŸ“„ Ø§Ù„ØµÙØ­Ø© ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"),setTimeout(()=>{const e=document.getElementById("initialLoader");e&&"none"!==e.style.display&&(console.log("âš ï¸ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø§ ØªØ²Ø§Ù„ Ø¸Ø§Ù‡Ø±Ø©ØŒ Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ø±ÙŠ..."),forceHideLoader())},2e3)}),window.addEventListener("error",function(e){console.error("Ø®Ø·Ø£ Ø¹Ø§Ù…:",e),showToast(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${e.message}`,"error")}),window.addEventListener("unhandledrejection",function(e){console.error("ÙˆØ¹Ø¯ Ù…Ø±ÙÙˆØ¶:",e.reason),showToast(`Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${e.reason.message||e.reason}`,"error")}),window.addToCart=addToCartWithQuantity,window.openQuantityModal=openQuantityModal,window.closeQuantityModal=closeQuantityModal,window.addToCartFromModal=addToCartFromModal,window.buyNowFromModal=buyNowFromModal,window.toggleFavorite=toggleFavorite,window.updateCartQuantity=updateCartQuantity,window.removeFromCart=removeFromCart,window.signInAsGuest=signInAsGuest,window.signInWithGoogle=signInWithGoogle,window.signOutUser=signOutUser,window.showSection=showSection,window.clearCart=clearCart,window.editProfile=editProfile,window.saveProfileChanges=saveProfileChanges,window.performSearch=performSearch,window.filterProducts=filterProducts,window.openCheckoutModal=openCheckoutModal,window.closeCheckoutModal=closeCheckoutModal,window.confirmOrder=confirmOrder,window.previewReceipt=previewReceipt,window.removeReceiptPreview=removeReceiptPreview,window.viewReceipt=viewReceipt,window.buyNowDirect=buyNowDirect,window.signUpWithEmail=signUpWithEmail,window.handleRegistration=handleRegistration,window.handleLogin=handleLogin,window.showRegistrationForm=showRegistrationForm,window.showLoginForm=showLoginForm,window.filterMainProducts=filterMainProducts,window.hideLoader=hideLoader,window.formatNumber=formatNumber,window.generateGuestUID=generateGuestUID,window.uploadReceiptImage=uploadReceiptImage,window.addEventListener("resize",adjustLayout),console.log("ğŸš€ ØªØ·Ø¨ÙŠÙ‚ Queen Beauty Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ 100%!");const originalAddToCart=window.addToCart;window.addToCart=async function(e,t){setTimeout(async()=>{await saveUserDataToFirestore()},500)};const originalToggleFavorite=window.toggleFavorite;function getRatingHTML(e=5){let t='<div class="product-rating" style="color: #f1c40f; font-size: 12px; margin: 5px 0;">';for(let o=1;o<=5;o++)t+=`<i class="${o<=e?"fas":"far"} fa-star"></i>`;return t+="</div>",t}window.toggleFavorite=async function(e){setTimeout(async()=>{await saveUserDataToFirestore()},500)},window.shareProduct=function(e){const t=allProducts.find(t=>t.id===e);if(!t)return;const o=`Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬: ${t.name}\nØ§Ù„Ø³Ø¹Ø±: ${t.price} ${siteCurrency}`;navigator.share?navigator.share({title:t.name,text:o,url:window.location.href}):window.open(`https://wa.me/?text=${encodeURIComponent(o+"\n"+window.location.href)}`)};let activeCoupon=null;function displayOrderTrackingResult(e){const t=document.getElementById("trackingResult");if(!t)return;t.innerHTML=`\n        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 15px;">\n            <h4 style="color: var(--primary-color); margin-bottom: 10px;">Ø·Ù„Ø¨ #${e.orderId}</h4>\n            <p>Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${{pending:"Ø§Ù†ØªØ¸Ø§Ø±",processing:"ØªÙ†ÙÙŠØ°",shipped:"Ø´Ø­Ù†",delivered:"ØªÙˆØµÙŠÙ„"}[e.status]||e.status}</strong></p>\n            <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(e.total)} ${siteCurrency}</p>\n        </div>\n    `,t.style.display="block"}window.applyCoupon=async function(){const e=document.getElementById("couponCode")?.value?.trim()?.toUpperCase();if(!e)return showToast("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…","warning");showLoadingSpinner("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...");try{const t=window.firebaseModules.query(window.firebaseModules.collection(db,"coupons"),window.firebaseModules.where("code","==",e),window.firebaseModules.where("isActive","==",!0)),o=await window.firebaseModules.getDocs(t);if(o.empty)throw new Error("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­");activeCoupon=o.docs[0].data(),showToast("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…","success"),"function"==typeof updateCartUI&&updateCartUI()}catch(e){showToast(e.message,"error"),activeCoupon=null,"function"==typeof updateCartUI&&updateCartUI()}finally{hideLoadingSpinner()}},window.trackOrder=async function(){const e=document.getElementById("trackOrderId")?.value?.trim()?.replace("NO:","");if(!e)return showToast("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨","warning");showLoadingSpinner("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...");try{const t=window.firebaseModules.query(window.firebaseModules.collection(db,"orders"),window.firebaseModules.where("orderId","==",e)),o=await window.firebaseModules.getDocs(t);if(o.empty)return showToast("Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯","error");displayOrderTrackingResult(o.docs[0].data())}catch(e){showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØªØ¨Ø¹","error")}finally{hideLoadingSpinner()}};const recentNames=["Ø£Ø­Ù…Ø¯","Ø³Ø§Ø±Ø©","Ù…Ø­Ù…Ø¯","Ù„ÙŠÙ„Ù‰","Ø®Ø§Ù„Ø¯","Ù†ÙˆØ±Ø©","ÙŠØ§Ø³ÙŠÙ†","Ù…Ø±ÙŠÙ…"],recentCities=["Ø§Ù„Ø®Ø±Ø·ÙˆÙ…","Ø£Ù… Ø¯Ø±Ù…Ø§Ù†","Ø¨Ø­Ø±ÙŠ","Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†","Ù…Ø¯Ù†ÙŠ"];function showRecentPurchase(){if(document.hidden)return;const e=recentNames[Math.floor(Math.random()*recentNames.length)],t=recentCities[Math.floor(Math.random()*recentCities.length)],o=allProducts.length>0?allProducts[Math.floor(Math.random()*allProducts.length)].name:"Ø¹Ø·Ø± Ù…Ù„ÙƒÙŠ";let n=document.querySelector(".recent-purchase-toast");n||(n=document.createElement("div"),n.className="recent-purchase-toast",document.body.appendChild(n)),n.innerHTML=`\n        <div style="width: 40px; height: 40px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">\n            <i class="fas fa-shopping-bag"></i>\n        </div>\n        <div>\n            <p style="margin: 0; font-weight: bold;">${e} Ù…Ù† ${t}</p>\n            <p style="margin: 0; font-size: 11px; color: var(--gray-color);">Ø§Ø´ØªØ±Ù‰ Ù„Ù„ØªÙˆ: ${o}</p>\n        </div>\n    `,setTimeout(()=>n.classList.add("show"),100),setTimeout(()=>n.classList.remove("show"),5e3)}function showSearchSuggestions(e){let t=document.getElementById("searchSuggestions");t||(t=document.createElement("div"),t.id="searchSuggestions",t.style.cssText="\n            position: absolute; top: 100%; left: 0; right: 0;\n            background: white; border-radius: 0 0 15px 15px;\n            box-shadow: 0 10px 20px rgba(0,0,0,0.1); z-index: 1001;\n            max-height: 300px; overflow-y: auto; border: 1px solid #eee;\n        ",document.querySelector(".search-container").style.position="relative",document.querySelector(".search-container").appendChild(t)),0===e.length?t.innerHTML='<p style="padding: 15px; text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>':t.innerHTML=e.map(e=>`\n            <div onclick="viewProductDetails('${e.id}')" style="padding: 10px 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-bottom: 1px solid #f5f5f5;" onmouseover="this.style.background='#f9f9f9'" onmouseout="this.style.background='white'">\n                <img src="${e.image}" style="width: 30px; height: 30px; object-fit: cover; border-radius: 4px;">\n                <span style="font-size: 14px;">${e.name}</span>\n                <span style="margin-right: auto; font-weight: bold; color: var(--primary-color); font-size: 12px;">${formatNumber(e.price)}</span>\n            </div>\n        `).join(""),t.style.display="block"}function hideSearchSuggestions(){const e=document.getElementById("searchSuggestions");e&&(e.style.display="none")}setInterval(()=>{Math.random()>.7&&showRecentPurchase()},12e4),window.initSmartSearch=function(){const e=document.querySelector(".search-container input");e&&e.addEventListener("input",e=>{const t=e.target.value.toLowerCase().trim();if(t.length<2)return void hideSearchSuggestions();showSearchSuggestions(allProducts.filter(e=>e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)).slice(0,5))})},document.addEventListener("click",e=>{e.target.closest(".search-container")||hideSearchSuggestions()}),document.addEventListener("DOMContentLoaded",()=>{setTimeout(window.initSmartSearch,2e3)}),window.initImageZoom=function(){document.querySelectorAll(".product-image img").forEach(e=>{e.addEventListener("mousemove",t=>{const{left:o,top:n,width:s,height:i}=e.getBoundingClientRect(),r=(t.pageX-o-window.scrollX)/s*100,a=(t.pageY-n-window.scrollY)/i*100;e.style.transformOrigin=`${r}% ${a}%`,e.style.transform="scale(1.5)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.transformOrigin="center"})})},window.showSkeletons=function(){const e=document.getElementById("productsGrid");e&&(e.innerHTML=Array(6).fill(0).map(()=>'\n        <div class="product-card skeleton-card" style="pointer-events: none;">\n            <div class="skeleton" style="height: 200px; margin-bottom: 15px;"></div>\n            <div class="skeleton" style="height: 20px; width: 70%; margin-bottom: 10px;"></div>\n            <div class="skeleton" style="height: 15px; width: 40%; margin-bottom: 15px;"></div>\n            <div class="skeleton" style="height: 40px; width: 100%;"></div>\n        </div>\n    ').join(""))};const originalLoadProducts=window.loadProducts;window.loadProducts=async function(){window.showSkeletons(),await new Promise(e=>setTimeout(e,800)),"function"==typeof originalLoadProducts&&await originalLoadProducts(),window.initImageZoom()};let lastScroll=0;window.addEventListener("scroll",()=>{const e=document.querySelector(".header");if(!e)return;const t=window.pageYOffset;t<=0?e.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)":(t>lastScroll&&t>100?(e.style.transform="translateY(-10%)",e.style.opacity="0.95"):(e.style.transform="translateY(0)",e.style.opacity="1",e.style.boxShadow="0 5px 20px rgba(0,0,0,0.15)"),lastScroll=t)});