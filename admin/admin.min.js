function formatNumber(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}console.log("ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Queen Beauty");let adminDb=null,adminStorage=null,siteCurrency="SDG",currentEditingProductId=null,productToDelete=null,lastOrderNumber=11001e3;async function checkFirestoreConnection(){try{console.log("ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");const e=window.firebaseModules.collection(adminDb,"settings"),o=await window.firebaseModules.getDocs(e);return console.log("âœ… Ø§ØªØµØ§Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ø¬Ø­"),o.empty&&(console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§..."),await createDefaultSettings()),!0}catch(e){return console.error("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e),showToast("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: "+e.message,"error"),!1}}async function createDefaultSettings(){try{const e=window.firebaseModules.doc(adminDb,"settings","site_config"),o={storeName:"Queen Beauty",email:"yxr.249@gmail.com",phone:"+249933002015",address:"Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø§Ù„Ø®Ø±Ø·ÙˆÙ…",shippingCost:15,freeShippingLimit:200,workingHours:"Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³: 9 ØµØ¨Ø§Ø­Ø§Ù‹ - 10 Ù…Ø³Ø§Ø¡Ù‹",aboutUs:"Ù…ØªØ¬Ø± Ù…ØªØ®ØµØµ ÙÙŠ Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠØ©",logoUrl:"https://i.ibb.co/N6Bfb1KW/file-00000000e020720cbb1ddc5fc4577270.png",bankName:"Ø¨Ù†Ùƒ Ø§Ù„Ø®Ø±Ø·ÙˆÙ… (Ø¨Ù†ÙƒÙƒ)",bankAccount:"1234567",bankAccountName:"Ù…ØªØ¬Ø± Eleven Ù„Ù„Ø¹Ø·ÙˆØ±",lastOrderNumber:11001e3,createdAt:window.firebaseModules.serverTimestamp(),updatedAt:window.firebaseModules.serverTimestamp()};return await window.firebaseModules.setDoc(e,o),console.log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"),!0}catch(e){return console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:",e),!1}}async function initAdminApp(){console.log("ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...");const e=localStorage.getItem("currentUser");if(!e)return showToast("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹","error"),void setTimeout(()=>window.location.href="index.html",2e3);try{const o=JSON.parse(e);if(console.log("ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",o),o.isGuest)return showToast("Ø§Ù„Ø¶ÙŠÙˆÙ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…","error"),void setTimeout(()=>window.location.href="index.html",2e3);if(!o.isAdmin&&"admin"!==o.role)return showToast("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…","error"),void setTimeout(()=>window.location.href="index.html",2e3);const t={apiKey:"AIzaSyB1vNmCapPK0MI4H_Q0ilO7OnOgZa02jx0",authDomain:"queen-beauty-b811b.firebaseapp.com",projectId:"queen-beauty-b811b",storageBucket:"queen-beauty-b811b.firebasestorage.app",messagingSenderId:"418964206430",appId:"1:418964206430:web:8c9451fc56ca7f956bd5cf"};let n;try{n=window.firebaseModules.getApp("AdminApp")}catch(e){n=window.firebaseModules.initializeApp(t,"AdminApp")}adminDb=window.firebaseModules.getFirestore(n),adminStorage=window.firebaseModules.getStorage(n),console.log("âœ… Firebase Ù…Ù‡ÙŠØ£");if(!await checkFirestoreConnection())throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");await loadLastOrderNumber(),setupAdminEventListeners(),await loadAdminDashboard(),setupOrderNotificationsListener(),console.log("ğŸ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²Ø©")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: "+e.message,"error")}}async function loadLastOrderNumber(){try{const e=window.firebaseModules.doc(adminDb,"settings","site_config"),o=await window.firebaseModules.getDoc(e);if(o.exists()){const e=o.data();lastOrderNumber=e.lastOrderNumber||11001e3,console.log("ğŸ”¢ Ø¢Ø®Ø± Ø±Ù‚Ù… Ø·Ù„Ø¨ Ù…Ø­Ù…Ù„:",lastOrderNumber)}}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø±Ù‚Ù… Ø·Ù„Ø¨:",e),lastOrderNumber=11001e3}}async function getNextOrderNumber(){lastOrderNumber+=1;try{const e=window.firebaseModules.doc(adminDb,"settings","site_config");await window.firebaseModules.updateDoc(e,{lastOrderNumber:lastOrderNumber,updatedAt:window.firebaseModules.serverTimestamp()}),console.log("ğŸ”¢ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:",lastOrderNumber)}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:",e)}return lastOrderNumber}async function loadAdminDashboard(){try{console.log("ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."),await Promise.all([loadAdminStats(),loadAdminProducts(),loadAdminOrders(),loadAdminUsers(),loadAdminSettings(),loadThemeSettings(),loadButtonPressColorSettings()]),console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","error")}}async function loadAdminStats(){try{console.log("ğŸ“ˆ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...");const e=(await window.firebaseModules.getDocs(window.firebaseModules.collection(adminDb,"users"))).docs.filter(e=>!e.data().isGuest).length;document.getElementById("adminUsersCount").textContent=formatNumber(e);const o=window.firebaseModules.query(window.firebaseModules.collection(adminDb,"products"),window.firebaseModules.where("isActive","==",!0)),t=await window.firebaseModules.getDocs(o);document.getElementById("adminProductsCount").textContent=formatNumber(t.size);const n=await window.firebaseModules.getDocs(window.firebaseModules.collection(adminDb,"orders"));let r=0,s=0,a=0;n.forEach(e=>{const o=e.data();"delivered"===o.status&&(s++,r+=parseFloat(o.total||0)),"pending"===o.status&&a++}),document.getElementById("adminCompletedOrdersCount").textContent=formatNumber(s),document.getElementById("adminTotalSales").textContent=formatNumber(r)+" "+siteCurrency;const i=document.getElementById("advancedStatsContainer");i&&(i.innerHTML=`\n                <div style="margin-top: 30px; padding: 20px; background: #fff; border-radius: 12px; border: 1px solid var(--border-color);">\n                    <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">\n                        <i class="fas fa-info-circle" style="color: var(--secondary-color);"></i>\n                        Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©\n                    </h4>\n                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">\n                        <div style="padding: 15px; background: var(--light-color); border-radius: 8px; text-align: center;">\n                            <span style="display: block; font-size: 20px; font-weight: 700; color: var(--warning-color);">${a}</span>\n                            <span style="font-size: 12px; color: var(--gray-color);">Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>\n                        </div>\n                        <div style="padding: 15px; background: var(--light-color); border-radius: 8px; text-align: center;">\n                            <span style="display: block; font-size: 20px; font-weight: 700; color: var(--primary-color);">${n.size}</span>\n                            <span style="font-size: 12px; color: var(--gray-color);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>\n                        </div>\n                        <div style="padding: 15px; background: var(--light-color); border-radius: 8px; text-align: center; display: none;">\n                            <span style="display: block; font-size: 20px; font-weight: 700; color: var(--secondary-color);">NO:${lastOrderNumber}</span>\n                            <span style="font-size: 12px; color: var(--gray-color);">Ø¢Ø®Ø± Ø±Ù‚Ù… Ø·Ù„Ø¨</span>\n                        </div>\n                    </div>\n                </div>\n            `)}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:",e)}}async function loadAdminProducts(){try{console.log("ğŸ“¦ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...");const e=document.getElementById("adminProductsList");if(!e)return void console.error("âŒ Ø¹Ù†ØµØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");e.innerHTML='\n            <div style="text-align: center; padding: 40px;">\n                <div style="width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: var(--secondary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>\n                <p style="color: var(--gray-color);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>\n            </div>\n        ';const o=window.firebaseModules.query(window.firebaseModules.collection(adminDb,"products"),window.firebaseModules.orderBy("createdAt","desc")),t=await window.firebaseModules.getDocs(o);if(console.log("ğŸ“¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:",t.size),t.empty)return console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª"),void(e.innerHTML='\n                <div style="text-align: center; padding: 60px 20px;">\n                    <i class="fas fa-box-open fa-3x" style="color: var(--gray-color); margin-bottom: 20px;"></i>\n                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>\n                    <p style="color: var(--gray-color); margin-bottom: 20px;">Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</p>\n                    <button class="btn-primary" onclick="openAddProductModal()" \n                            style="padding: 12px 25px; background: var(--secondary-color); color: white; border: none; border-radius: 10px; font-family: \'Cairo\'; cursor: pointer; font-weight: 600;">\n                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯\n                    </button>\n                </div>\n            ');let n="";t.forEach(e=>{const o=e.data(),t=e.id;console.log("ğŸ“ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù†ØªØ¬:",o.name);const r=!0===o.isNew,s=!0===o.isSale,a=!0===o.isBest,i=!1!==o.isActive;n+=`\n                <div class="admin-product-card" data-id="${t}">\n                    <div class="admin-product-image">\n                        <img src="${o.image||"https://via.placeholder.com/80x80"}" \n                             alt="${o.name}"\n                             onerror="this.src='https://via.placeholder.com/80x80'">\n                    </div>\n                    <div class="admin-product-info">\n                        <h4>${o.name||"Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</h4>\n                        <p style="color: var(--gray-color); font-size: 12px; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px;">\n                            ${o.description||"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ù…Ù†ØªØ¬"}\n                        </p>\n                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">\n                            <p><i class="fas fa-tag"></i> ${o.category||"Ø¨Ø¯ÙˆÙ† ÙØ¦Ø©"}</p>\n                            <p><i class="fas fa-box"></i> ${formatNumber(o.stock||0)} Ù‚Ø·Ø¹Ø©</p>\n                        </div>\n                        <p style="font-size: 18px; font-weight: 700; color: var(--secondary-color); margin-bottom: 10px;">\n                            ${formatNumber(o.price||0)} ${siteCurrency}\n                        </p>\n                        <div class="product-status">\n                            <span class="status-badge ${i?"active":"inactive"}">\n                                ${i?"Ù†Ø´Ø·":"ØºÙŠØ± Ù†Ø´Ø·"}\n                            </span>\n                            ${r?'<span class="status-badge new">Ø¬Ø¯ÙŠØ¯</span>':""}\n                            ${s?'<span class="status-badge sale">Ø¹Ø±Ø¶</span>':""}\n                            ${a?'<span class="status-badge best">Ø§Ù„Ø£ÙØ¶Ù„</span>':""}\n                        </div>\n                    </div>\n                    <div class="admin-product-actions">\n                        <button class="action-icon-btn edit-btn" onclick="editProduct('${t}')" title="ØªØ¹Ø¯ÙŠÙ„">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="action-icon-btn delete-btn" onclick="confirmDeleteProduct('${t}')" title="ØªØ¹Ø·ÙŠÙ„">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            `}),e.innerHTML=n,console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:",e),document.getElementById("adminProductsList").innerHTML=`\n            <div style="text-align: center; padding: 40px 20px;">\n                <i class="fas fa-exclamation-triangle fa-3x" style="color: var(--danger-color); margin-bottom: 20px;"></i>\n                <h3 style="color: var(--primary-color); margin-bottom: 10px;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>\n                <p style="color: var(--gray-color); margin-bottom: 20px;">${e.message}</p>\n                <button class="btn-primary" onclick="loadAdminProducts()" \n                        style="padding: 12px 25px; background: var(--secondary-color); color: white; border: none; border-radius: 10px; font-family: 'Cairo'; cursor: pointer; font-weight: 600;">\n                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©\n                </button>\n            </div>\n        `}}async function loadAdminUsers(){try{console.log("ğŸ‘¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...");const e=document.getElementById("adminUsersList");if(!e)return;const o=await window.firebaseModules.getDocs(window.firebaseModules.collection(adminDb,"users"));if(console.log("ğŸ“¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ„Ù…:",o.size),o.empty)return void(e.innerHTML='\n                <div style="text-align: center; padding: 60px 20px;">\n                    <i class="fas fa-users fa-3x" style="color: var(--gray-color); margin-bottom: 20px;"></i>\n                    <h3 style="color: var(--primary-color);">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>\n                </div>\n            ');let t="";o.forEach(e=>{const o=e.data(),n=e.id;if(o.isGuest)return;const r=o.createdAt?.toDate?o.createdAt.toDate().toLocaleDateString("ar-SA"):"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",s=o.isAdmin?"ğŸ‘‘ Ù…Ø³Ø¤ÙˆÙ„":"ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ",a=o.isAdmin?"admin-user":"regular-user";t+=`\n                <div class="user-card ${a}" data-id="${n}">\n                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">\n                        <img src="${o.photoURL||"https://i.ibb.co/nNx4v1x5/images-1.png"}" \n                             alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"\n                             style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">\n                        <div style="flex: 1;">\n                            <h4 style="margin: 0 0 5px 0; color: var(--primary-color);">${o.name||"Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</h4>\n                            <p style="margin: 0 0 5px 0; color: var(--gray-color);"><i class="fas fa-envelope"></i> ${o.email||"Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯"}</p>\n                            <p style="margin: 0 0 10px 0; color: ${o.isAdmin?"var(--secondary-color)":"var(--primary-color)"}; font-weight: bold;">\n                                ${s}\n                            </p>\n                            <div style="display: flex; gap: 15px; margin: 10px 0; flex-wrap: wrap;">\n                                <span style="color: var(--gray-color);"><i class="fas fa-shopping-cart"></i> ${o.totalOrders||0} Ø·Ù„Ø¨Ø§Øª</span>\n                                <span style="color: var(--gray-color);"><i class="fas fa-money-bill-wave"></i> ${o.totalSpent||0} ${siteCurrency}</span>\n                            </div>\n                            <p style="margin: 0; color: var(--gray-color); font-size: 14px;"><i class="fas fa-calendar-alt"></i> ${r}</p>\n                        </div>\n                    </div>\n                </div>\n            `}),e.innerHTML=t,console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:",e),usersList.innerHTML='\n            <div style="text-align: center; padding: 40px 20px;">\n                <i class="fas fa-exclamation-triangle" style="color: var(--danger-color); font-size: 40px; margin-bottom: 15px;"></i>\n                <h4 style="color: var(--primary-color);">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>\n                <button class="btn-primary" onclick="loadAdminUsers()" \n                        style="padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 8px; margin-top: 10px; font-family: \'Cairo\';">\n                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©\n                </button>\n            </div>\n        '}}async function loadAdminOrders(){try{console.log("ğŸ›’ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...");const e=document.getElementById("adminOrdersList"),o=document.getElementById("orderStatusFilter")?.value||"all";if(!e)return;e.innerHTML='\n            <div style="text-align: center; padding: 40px;">\n                <div style="width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: var(--secondary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>\n                <p style="color: var(--gray-color);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>\n            </div>\n        ';let t=window.firebaseModules.query(window.firebaseModules.collection(adminDb,"orders"),window.firebaseModules.orderBy("createdAt","desc"));"all"!==o&&(t=window.firebaseModules.query(window.firebaseModules.collection(adminDb,"orders"),window.firebaseModules.where("status","==",o),window.firebaseModules.orderBy("createdAt","desc")));const n=await window.firebaseModules.getDocs(t);if(n.empty)return void(e.innerHTML='\n                <div style="text-align: center; padding: 60px 20px;">\n                    <i class="fas fa-shopping-basket fa-3x" style="color: var(--gray-color); margin-bottom: 20px;"></i>\n                    <h3 style="color: var(--primary-color);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>\n                </div>\n            ');let r="";n.forEach(e=>{const o=e.data(),t=e.id;let n="ØºÙŠØ± Ù…Ø­Ø¯Ø¯";try{if(o.createdAt){n=(o.createdAt.seconds?new Date(1e3*o.createdAt.seconds):new Date(o.createdAt)).toLocaleString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}}catch(e){console.error("Error formatting date:",e)}const s={pending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",paid:"ØªÙ… Ø§Ù„Ø¯ÙØ¹",processing:"ÙŠØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²",shipped:"ØªÙ… Ø§Ù„Ø´Ø­Ù†",delivered:"ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",cancelled:"Ù…Ù„ØºÙŠ"}[o.status]||o.status,a={pending:"status-pending",paid:"status-processing",processing:"status-processing",shipped:"status-shipped",delivered:"status-delivered",cancelled:"status-cancelled"}[o.status]||"status-pending",i=o.orderId||"NO:"+(311e3+parseInt(t.substring(0,8),16)%1e3);r+=`\n                <div class="order-card" id="order-${t}">\n                    <div class="order-header">\n                        <div>\n                            <span class="order-id">Ø·Ù„Ø¨ ${i}</span>\n                            <span class="order-date">${n}</span>\n                        </div>\n                        <span class="order-status-badge ${a}">\n                            ${s}\n                        </span>\n                    </div>\n                    <div class="order-body">\n                        <div class="order-info">\n                            <h5>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h5>\n                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${o.customerName||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</p>\n                            <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${o.customerPhone||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n                            <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${o.address||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>\n                            ${o.notes?`<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${o.notes}</p>`:""}\n                        </div>\n                        <div class="order-items">\n                            <h5>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${o.items?.length||0})</h5>\n                            ${(o.items||[]).map(e=>`\n                                <div class="order-item-row">\n                                    <span>${e.name} Ã— ${e.quantity||1}</span>\n                                    <span>${formatNumber((e.price||0)*(e.quantity||1))} ${siteCurrency}</span>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                    \n                    <div class="receipt-section" style="margin: 15px 0; padding: 15px; background: var(--light-color); border-radius: 10px; border: 1px solid var(--border-color);">\n                        <h5 style="margin-bottom: 10px;">Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</h5>\n                        ${o.receiptImage?`\n                            <div style="display: flex; align-items: flex-start; gap: 15px; flex-wrap: wrap;">\n                                <img src="${o.receiptImage}" \n                                     alt="Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„" \n                                     style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid var(--secondary-color);"\n                                     onclick="showFullImage('${o.receiptImage}')"\n                                     onerror="this.style.display='none'">\n                                <div>\n                                    <p style="margin: 5px 0;"><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${o.receiptFileName||"Ø¥ÙŠØµØ§Ù„"}</p>\n                                    <p style="margin: 5px 0;"><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù:</strong> ${o.receiptFileType||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</p>\n                                    <p style="margin: 5px 0;"><strong>Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${formatFileSize(o.receiptFileSize||0)}</p>\n                                    <div style="display: flex; gap: 10px; margin-top: 10px;">\n                                        <button onclick="showFullImage('${o.receiptImage}')" \n                                                class="btn-secondary" \n                                                style="padding: 8px 15px; font-size: 14px;">\n                                            <i class="fas fa-expand"></i> Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„\n                                        </button>\n                                        <button onclick="downloadImage('${o.receiptImage}', 'Ø¥ÙŠØµØ§Ù„_${i}.jpg')" \n                                                class="btn-primary" \n                                                style="padding: 8px 15px; font-size: 14px;">\n                                            <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        `:'\n                            <div style="text-align: center; padding: 20px;">\n                                <i class="fas fa-exclamation-circle fa-2x" style="color: var(--danger-color); margin-bottom: 10px;"></i>\n                                <p style="color: var(--danger-color); margin: 0;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØµØ§Ù„ Ù…Ø±ÙÙ‚</p>\n                            </div>\n                        '}\n                    </div>\n                    \n                    <div class="order-footer">\n                        <div class="order-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(o.total||0)} ${siteCurrency}</div>\n                        <div class="order-actions">\n                            <select class="status-select" onchange="updateOrderStatus('${t}', this.value)">\n                                <option value="pending" ${"pending"===o.status?"selected":""}>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>\n                                <option value="paid" ${"paid"===o.status?"selected":""}>ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>\n                                <option value="processing" ${"processing"===o.status?"selected":""}>ÙŠØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>\n                                <option value="shipped" ${"shipped"===o.status?"selected":""}>ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>\n                                <option value="delivered" ${"delivered"===o.status?"selected":""}>ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>\n                                <option value="cancelled" ${"cancelled"===o.status?"selected":""}>Ù…Ù„ØºÙŠ</option>\n                            </select>\n                            <button class="delete-btn action-icon-btn" onclick="deleteOrder('${t}')" title="Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨">\n                                <i class="fas fa-trash"></i>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `}),e.innerHTML=r}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª","error")}}function showFullImage(e){const o=document.createElement("div");o.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0,0,0,0.95);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 2000;\n        padding: 20px;\n    ",o.innerHTML=`\n        <div style="position: relative; max-width: 90%; max-height: 90%;">\n            <img src="${e}" \n                 style="max-width: 100%; max-height: 80vh; border-radius: 5px; box-shadow: 0 5px 30px rgba(0,0,0,0.5); display: block; margin: 0 auto;">\n            <div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 10px;">\n                <button onclick="downloadImage('${e}', 'Ø¥ÙŠØµØ§Ù„_${Date.now()}.jpg')" \n                        class="btn-primary" \n                        style="padding: 10px 15px; font-size: 14px; display: flex; align-items: center; justify-content: center;">\n                    <i class="fas fa-download"></i>\n                </button>\n                <button onclick="this.parentElement.parentElement.parentElement.remove()" \n                        class="btn-secondary" \n                        style="padding: 10px 15px; font-size: 14px; display: flex; align-items: center; justify-content: center;">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        </div>\n    `,o.addEventListener("click",e=>{e.target===o&&o.remove()}),document.body.appendChild(o)}function downloadImage(e,o){const t=document.createElement("a");t.href=e,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function formatFileSize(e){if(0===e)return"0 Bytes";const o=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,o)).toFixed(2))+" "+["Bytes","KB","MB","GB"][o]}async function updateOrderStatus(e,o){try{console.log(`ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ${e} Ø¥Ù„Ù‰ ${o}`);const t=window.firebaseModules.doc(adminDb,"orders",e),n=await window.firebaseModules.getDoc(t);if(!n.exists())throw new Error("Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");const r=n.data(),s=r.status;if(s===o)return;await window.firebaseModules.updateDoc(t,{status:o,updatedAt:window.firebaseModules.serverTimestamp()});const a=["paid","processing","shipped","delivered"],i=a.includes(o),d=a.includes(s);if(i&&!d&&(console.log("ğŸ“‰ Ø¬Ø§Ø±ÙŠ Ø®ØµÙ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†..."),r.items&&Array.isArray(r.items)))for(const e of r.items)try{const o=e.id||e.productId;if(!o)continue;const t=window.firebaseModules.doc(adminDb,"products",o),n=parseInt(e.quantity)||1;await window.firebaseModules.updateDoc(t,{stock:window.firebaseModules.increment(-n),updatedAt:window.firebaseModules.serverTimestamp()}),console.log(`âœ… ØªÙ… Ø®ØµÙ… ${n} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ ${o}`)}catch(o){console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø®ØµÙ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù„Ù…Ù†ØªØ¬ ${e.id}:`,o)}if("cancelled"===o&&d&&(console.log("ğŸ“ˆ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ†..."),r.items&&Array.isArray(r.items)))for(const e of r.items)try{const o=e.id||e.productId;if(!o)continue;const t=window.firebaseModules.doc(adminDb,"products",o),n=parseInt(e.quantity)||1;await window.firebaseModules.updateDoc(t,{stock:window.firebaseModules.increment(n),updatedAt:window.firebaseModules.serverTimestamp()}),console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ${n} Ù„Ù„Ù…Ù†ØªØ¬ ${o}`)}catch(o){console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù„Ù…Ù†ØªØ¬ ${e.id}:`,o)}if(r.userId&&"guest"!==r.userId&&await sendOrderStatusNotification(r,o),i&&!d&&r.userId&&"guest"!==r.userId)try{const e=window.firebaseModules.doc(adminDb,"users",r.userId);await window.firebaseModules.updateDoc(e,{totalOrders:window.firebaseModules.increment(1),totalSpent:window.firebaseModules.increment(r.total),lastOrderDate:window.firebaseModules.serverTimestamp()})}catch(e){console.error("Error updating user stats:",e)}showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­","success"),loadAdminOrders(),loadAdminStats()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©","error")}}async function deleteOrder(e){if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ"))try{const o=window.firebaseModules.doc(adminDb,"orders",e);await window.firebaseModules.deleteDoc(o),showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­","success"),loadAdminOrders(),loadAdminStats()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨:",e),showToast("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨","error")}}async function loadAdminSettings(){try{console.log("âš™ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...");const e=document.getElementById("settingsForm");if(!e)return;const o=window.firebaseModules.doc(adminDb,"settings","site_config"),t=await window.firebaseModules.getDoc(o);let n={};t.exists()?(n=t.data(),console.log("ğŸ“„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©:",n)):console.log("âš ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©"),e.innerHTML=`\n            <div style="margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color);">\n                <h4><i class="fas fa-store"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h4>\n                \n                <div class="form-group">\n                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± *</label>\n                    <input type="text" id="storeName" value="${n.storeName||"Queen Beauty"}" required>\n                </div>\n                \n                <div class="form-group">\n                    <label>Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø± (Logo)</label>\n                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">\n                        <input type="file" id="logoUrlFile" accept="image/*" style="display: none;" onchange="handleLogoUpload(this)">\n                        <button type="button" class="btn-secondary" onclick="document.getElementById('logoUrlFile').click()" style="flex: 1;">\n                            <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø´Ø¹Ø§Ø±\n                        </button>\n                        <input type="url" id="logoUrl" value="${n.logoUrl||"https://i.ibb.co/N6Bfb1KW/file-00000000e020720cbb1ddc5fc4577270.png"}" placeholder="https://example.com/logo.png" style="flex: 2;">\n                    </div>\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>\n                        <input type="email" id="email" value="${n.email||"yxr.249@gmail.com"}" required>\n                    </div>\n                    <div class="form-group">\n                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>\n                        <input type="tel" id="phone" value="${n.phone||n.Phone||"+249933002015"}" required>\n                    </div>\n                </div>\n                \n                <div class="form-group">\n                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>\n                    <input type="text" id="address" value="${n.address||"Ø§Ù„Ø³ÙˆØ¯Ø§Ù† - Ø§Ù„Ø®Ø±Ø·ÙˆÙ…"}" required>\n                </div>\n            </div>\n            \n            <div style="margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color);">\n                <h4><i class="fas fa-truck"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†</h4>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† (${siteCurrency})</label>\n                        <input type="number" id="shippingCost" value="${n.shippingCost||15}" min="0">\n                    </div>\n                    <div class="form-group">\n                        <label>Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† (${siteCurrency})</label>\n                        <input type="number" id="freeShippingLimit" value="${n.freeShippingLimit||200}" min="0">\n                    </div>\n                </div>\n            </div>\n            \n            <div style="margin-bottom: 25px;">\n                <h4><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h4>\n                <div class="form-group">\n                    <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</label>\n                    <input type="text" id="workingHours" value="${n.workingHours||"Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³: 9 ØµØ¨Ø§Ø­Ø§Ù‹ - 10 Ù…Ø³Ø§Ø¡Ù‹"}">\n                </div>\n\n                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">\n                    <h4><i class="fas fa-university"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h4>\n                    <div class="form-group">\n                        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>\n                        <input type="text" id="bankName" value="${n.bankName||"Ø¨Ù†Ùƒ Ø§Ù„Ø®Ø±Ø·ÙˆÙ… (Ø¨Ù†ÙƒÙƒ)"}">\n                    </div>\n                    <div class="form-row">\n                        <div class="form-group">\n                            <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>\n                            <input type="text" id="bankAccount" value="${n.bankAccount||"1234567"}">\n                        </div>\n                        <div class="form-group">\n                            <label>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</label>\n                            <input type="text" id="bankAccountName" value="${n.bankAccountName||"Ù…ØªØ¬Ø± Eleven Ù„Ù„Ø¹Ø·ÙˆØ±"}">\n                        </div>\n                    </div>\n                </div>              \n                <div class="form-group">\n                    <label>ÙˆØµÙ Ø§Ù„Ù…ØªØ¬Ø±</label>\n                    <textarea id="aboutUs" rows="3">${n.aboutUs||"Ù…ØªØ¬Ø± Ù…ØªØ®ØµØµ ÙÙŠ Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ø·ÙˆØ± ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª Ø§Ù„ØªØ¬Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠØ©"}</textarea>\n                </div>\n            </div>\n            \n            <div style="margin-bottom: 25px;">\n                <h4><i class="fas fa-share-alt"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h4>\n                \n                <div class="form-group">\n                    <label><i class="fab fa-whatsapp"></i> Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</label>\n                    <input type="url" id="whatsappUrl" value="${n.whatsappUrl||""}" placeholder="https://wa.me/yournumber">\n                </div>\n                \n                <div class="form-group">\n                    <label><i class="fab fa-instagram"></i> Ø±Ø§Ø¨Ø· Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…</label>\n                    <input type="url" id="instagramUrl" value="${n.instagramUrl||""}" placeholder="https://instagram.com/yourprofile">\n                </div>\n                \n                <div class="form-group">\n                    <label><i class="fab fa-facebook"></i> Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ</label>\n                    <input type="url" id="facebookUrl" value="${n.facebookUrl||""}" placeholder="https://facebook.com/yourpage">\n                </div>\n                \n                <div class="form-group">\n                    <label><i class="fab fa-tiktok"></i> Ø±Ø§Ø¨Ø· ØªÙŠÙƒ ØªÙˆÙƒ</label>\n                    <input type="url" id="tiktokUrl" value="${n.tiktokUrl||""}" placeholder="https://tiktok.com/@youruser">\n                </div>\n            </div>\n            \n            <button type="button" id="saveSettingsBtn" class="btn-primary" style="width: 100%;">\n                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n            </button>\n        `,document.getElementById("saveSettingsBtn").addEventListener("click",saveAdminSettings),console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:",e),document.getElementById("settingsForm").innerHTML='\n            <div style="text-align: center; padding: 20px;">\n                <i class="fas fa-exclamation-triangle" style="color: var(--danger-color); font-size: 40px; margin-bottom: 15px;"></i>\n                <h4 style="color: var(--primary-color);">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h4>\n                <button class="btn-primary" onclick="loadAdminSettings()" \n                        style="padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 8px; margin-top: 10px; font-family: \'Cairo\';">\n                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©\n                </button>\n            </div>\n        '}}async function saveAdminSettings(){try{console.log("ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...");const e={storeName:document.getElementById("storeName").value.trim(),logoUrl:document.getElementById("logoUrl").value.trim(),email:document.getElementById("email").value.trim(),phone:document.getElementById("phone").value.trim(),address:document.getElementById("address").value.trim(),shippingCost:parseFloat(document.getElementById("shippingCost").value)||15,freeShippingLimit:parseFloat(document.getElementById("freeShippingLimit").value)||200,workingHours:document.getElementById("workingHours").value.trim(),aboutUs:document.getElementById("aboutUs").value.trim(),whatsappUrl:document.getElementById("whatsappUrl").value.trim(),instagramUrl:document.getElementById("instagramUrl").value.trim(),facebookUrl:document.getElementById("facebookUrl").value.trim(),tiktokUrl:document.getElementById("tiktokUrl").value.trim(),bankName:document.getElementById("bankName").value.trim(),bankAccount:document.getElementById("bankAccount").value.trim(),bankAccountName:document.getElementById("bankAccountName").value.trim(),lastOrderNumber:lastOrderNumber,updatedAt:window.firebaseModules.serverTimestamp()};if(!e.storeName||!e.email||!e.phone)return void showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©","warning");if(e.logoUrl&&!e.logoUrl.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i))return void showToast("Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ØµØ§Ù„Ø­","warning");const o=window.firebaseModules.doc(adminDb,"settings","site_config");await window.firebaseModules.setDoc(o,e,{merge:!0}),showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­","success"),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:",e)}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: "+e.message,"error")}}async function loadThemeSettings(){try{console.log("ğŸ¨ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†...");const e=window.firebaseModules.doc(adminDb,"settings","theme_colors"),o=await window.firebaseModules.getDoc(e);let t={};o.exists()?(t=o.data(),console.log("ğŸ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ù…Ù„Ø©:",t)):t={primaryColor:"#1C1C1C",secondaryColor:"#555555",successColor:"#27ae60",dangerColor:"#e74c3c",warningColor:"#f39c12",lightColor:"#F7F5F2",buttonPressColor:"#555555",updatedAt:window.firebaseModules.serverTimestamp()},document.getElementById("primaryColor").value=t.primaryColor||"#1C1C1C",document.getElementById("primaryColorHex").value=t.primaryColor||"#1C1C1C",document.getElementById("secondaryColor").value=t.secondaryColor||"#555555",document.getElementById("secondaryColorHex").value=t.secondaryColor||"#555555",document.getElementById("successColor").value=t.successColor||"#27ae60",document.getElementById("successColorHex").value=t.successColor||"#27ae60",document.getElementById("dangerColor").value=t.dangerColor||"#e74c3c",document.getElementById("dangerColorHex").value=t.dangerColor||"#e74c3c",document.getElementById("warningColor").value=t.warningColor||"#f39c12",document.getElementById("warningColorHex").value=t.warningColor||"#f39c12",document.getElementById("lightColor").value=t.lightColor||"#F7F5F2",document.getElementById("lightColorHex").value=t.lightColor||"#F7F5F2",document.getElementById("buttonPressColor").value=t.buttonPressColor||"#555555",document.getElementById("buttonPressColorHex").value=t.buttonPressColor||"#555555";const n=document.documentElement;Object.keys(t).forEach(e=>{if("updatedAt"!==e){const o="--"+e.replace(/([A-Z])/g,"-$1").toLowerCase();n.style.setProperty(o,t[e]),updateColorPreview(e,t[e])}}),setupColorInputEvents(),console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",e)}}function setupColorInputEvents(){["primaryColor","secondaryColor","successColor","dangerColor","warningColor","lightColor","buttonPressColor"].forEach(e=>{const o=document.getElementById(e),t=document.getElementById(e+"Hex");o&&t&&(o.addEventListener("input",function(){t.value=this.value,updateColorPreview(e,this.value)}),t.addEventListener("input",function(){const t=this.value.trim();t.match(/^#[0-9A-F]{6}$/i)&&(o.value=t,updateColorPreview(e,t))}),t.addEventListener("change",function(){const t=this.value.trim();t.startsWith("#")||(this.value="#"+t),t.match(/^#[0-9A-F]{6}$/i)&&(o.value=this.value,updateColorPreview(e,this.value))}))}),document.getElementById("saveColorsBtn").addEventListener("click",saveThemeColors),document.getElementById("resetColorsBtn").addEventListener("click",resetThemeColors)}function updateColorPreview(e,o){const t=document.querySelector(`.preview-${e.replace("Color","")}`),n=document.documentElement,r="--"+e.replace(/([A-Z])/g,"-$1").toLowerCase();if(n.style.setProperty(r,o),t&&(t.style.backgroundColor=o,"lightColor"===e)){const e=hexToRgb(o),n=(299*e.r+587*e.g+114*e.b)/1e3;t.style.color=n>125?"var(--dark-color)":"white"}}function hexToRgb(e){const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:{r:0,g:0,b:0}}async function saveThemeColors(){try{console.log("ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†...");const e={primaryColor:document.getElementById("primaryColorHex").value.trim(),secondaryColor:document.getElementById("secondaryColorHex").value.trim(),successColor:document.getElementById("successColorHex").value.trim(),dangerColor:document.getElementById("dangerColorHex").value.trim(),warningColor:document.getElementById("warningColorHex").value.trim(),lightColor:document.getElementById("lightColorHex").value.trim(),buttonPressColor:document.getElementById("buttonPressColorHex").value.trim(),updatedAt:window.firebaseModules.serverTimestamp()},o=/^#[0-9A-F]{6}$/i;for(const[t,n]of Object.entries(e))if(!o.test(n)&&"updatedAt"!==t)return void showToast(`Ø§Ù„Ù„ÙˆÙ† ${t} ØºÙŠØ± ØµØ§Ù„Ø­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØªÙ†Ø³ÙŠÙ‚ #RRGGBB)`,"error");const t=window.firebaseModules.doc(adminDb,"settings","theme_colors");await window.firebaseModules.setDoc(t,e,{merge:!0}),showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ù†Ø¬Ø§Ø­","success"),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",e)}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†: "+e.message,"error")}}async function resetThemeColors(){if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ"))try{const e={primaryColor:"#1C1C1C",secondaryColor:"#555555",successColor:"#27ae60",dangerColor:"#e74c3c",warningColor:"#f39c12",lightColor:"#F7F5F2"};document.getElementById("primaryColor").value=e.primaryColor,document.getElementById("primaryColorHex").value=e.primaryColor,document.getElementById("secondaryColor").value=e.secondaryColor,document.getElementById("secondaryColorHex").value=e.secondaryColor,document.getElementById("successColor").value=e.successColor,document.getElementById("successColorHex").value=e.successColor,document.getElementById("dangerColor").value=e.dangerColor,document.getElementById("dangerColorHex").value=e.dangerColor,document.getElementById("warningColor").value=e.warningColor,document.getElementById("warningColorHex").value=e.warningColor,document.getElementById("lightColor").value=e.lightColor,document.getElementById("lightColorHex").value=e.lightColor;for(const[o,t]of Object.entries(e))updateColorPreview(o,t);showToast("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©","success")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†","error")}}function openAddProductModal(){currentEditingProductId=null,document.getElementById("productModalTitle").textContent="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯",clearProductForm(),document.getElementById("productModal").classList.add("active")}async function editProduct(e){currentEditingProductId=e,document.getElementById("productModalTitle").textContent="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬";try{const o=window.firebaseModules.doc(adminDb,"products",e),t=await window.firebaseModules.getDoc(o);if(t.exists()){const e=t.data();document.getElementById("productName").value=e.name||"",document.getElementById("productPrice").value=e.price||0,document.getElementById("productCategory").value=e.category||"",document.getElementById("productStock").value=e.stock||0,document.getElementById("productDescription").value=e.description||"",document.getElementById("productImage").value=e.image||"",document.getElementById("productIsNew").checked=e.isNew||!1,document.getElementById("productIsSale").checked=e.isSale||!1,document.getElementById("productIsBest").checked=e.isBest||!1,document.getElementById("productIsActive").checked=!1!==e.isActive}}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬","error")}document.getElementById("productModal").classList.add("active")}function clearProductForm(){document.getElementById("productName").value="",document.getElementById("productPrice").value="",document.getElementById("productCategory").value="",document.getElementById("productStock").value="",document.getElementById("productDescription").value="",document.getElementById("productImage").value="",document.getElementById("productImageFile").value="",document.getElementById("productImagePreviewContainer").style.display="none",document.getElementById("productImagePreview").src="",document.getElementById("productIsNew").checked=!1,document.getElementById("productIsSale").checked=!1,document.getElementById("productIsBest").checked=!1,document.getElementById("productIsActive").checked=!0}async function handleProductImageUpload(e){if(e.files&&e.files[0]){const o=e.files[0],t=document.getElementById("productImagePreview"),n=document.getElementById("productImagePreviewContainer"),r=document.getElementById("uploadProgress");n.style.display="block",t.src=URL.createObjectURL(o),r.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";try{const e=window.firebaseModules.ref(adminStorage,`products/${Date.now()}_${o.name}`),t=window.firebaseModules.uploadBytesResumable(e,o);t.on("state_changed",e=>{const o=e.bytesTransferred/e.totalBytes*100;r.textContent=`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹: ${Math.round(o)}%`},e=>{console.error("Upload error:",e),showToast("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©","error"),r.textContent="ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹"},async()=>{const e=await window.firebaseModules.getDownloadURL(t.snapshot.ref);document.getElementById("productImage").value=e,r.textContent="âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­",showToast("ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­","success")})}catch(e){console.error("Error:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹","error")}}}async function handleLogoUpload(e){if(e.files&&e.files[0]){const o=e.files[0];showToast("Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±...","info");try{const e=window.firebaseModules.ref(adminStorage,`site/logo_${Date.now()}_${o.name}`),t=await window.firebaseModules.uploadBytes(e,o),n=await window.firebaseModules.getDownloadURL(t.ref);document.getElementById("logoUrl").value=n,showToast("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­","success")}catch(e){console.error("Logo upload error:",e),showToast("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±","error")}}}async function saveProduct(){try{const e={name:document.getElementById("productName").value.trim(),price:parseFloat(document.getElementById("productPrice").value)||0,category:document.getElementById("productCategory").value,stock:parseInt(document.getElementById("productStock").value)||0,description:document.getElementById("productDescription").value.trim(),image:document.getElementById("productImage").value.trim(),isNew:document.getElementById("productIsNew").checked,isSale:document.getElementById("productIsSale").checked,isBest:document.getElementById("productIsBest").checked,isActive:document.getElementById("productIsActive").checked,updatedAt:window.firebaseModules.serverTimestamp()};if(!(e.name&&e.price&&e.category&&e.image))return void showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©","warning");if(!e.image.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i))return void showToast("Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ØµØ§Ù„Ø­","warning");if(currentEditingProductId){const o=window.firebaseModules.doc(adminDb,"products",currentEditingProductId);await window.firebaseModules.updateDoc(o,e),showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­","success")}else{e.createdAt=window.firebaseModules.serverTimestamp();const o=window.firebaseModules.collection(adminDb,"products");await window.firebaseModules.addDoc(o,e),showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­","success")}closeModal(),await loadAdminProducts(),await loadAdminStats()}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬: "+e.message,"error")}}function confirmDeleteProduct(e){productToDelete=e,document.getElementById("confirmTitle").textContent="Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ",document.getElementById("confirmMessage").textContent="Ø³ÙŠØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ¹Ø¯Ù… Ø¹Ø±Ø¶Ù‡ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±.",document.getElementById("confirmModal").classList.add("active")}async function deleteProductConfirmed(){if(productToDelete)try{const e=window.firebaseModules.doc(adminDb,"products",productToDelete);await window.firebaseModules.updateDoc(e,{isActive:!1,updatedAt:window.firebaseModules.serverTimestamp()}),showToast("ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­","success"),closeModal(),await loadAdminProducts(),await loadAdminStats(),productToDelete=null}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬","error")}}function setupAdminEventListeners(){console.log("ğŸ”— Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«..."),setupColorInputSync(),document.querySelectorAll(".admin-tab").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.tab;if(!e)return;document.querySelectorAll(".admin-tab").forEach(e=>e.classList.remove("active")),this.classList.add("active"),document.querySelectorAll(".admin-tab-content").forEach(e=>{e.classList.remove("active")});const o=document.getElementById(e);o&&o.classList.add("active")})}),document.getElementById("addProductBtn").addEventListener("click",openAddProductModal),document.getElementById("saveProductBtn").addEventListener("click",saveProduct);const e=document.getElementById("saveSettingsBtn");e&&e.addEventListener("click",saveAdminSettings);const o=document.getElementById("saveColorsBtn");o&&o.addEventListener("click",saveButtonPressColor);const t=document.getElementById("resetColorsBtn");t&&t.addEventListener("click",resetButtonPressColor),document.addEventListener("click",function(e){(e.target.classList.contains("close-modal")||e.target.classList.contains("modal")||e.target.classList.contains("btn-secondary")&&e.target.textContent.includes("Ø¥Ù„ØºØ§Ø¡"))&&closeModal()}),loadAdminStats();const n=document.getElementById("orderStatusFilter");n&&n.addEventListener("change",loadAdminOrders),console.log("âœ… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¬Ø§Ù‡Ø²Ø©")}function closeModal(){document.querySelectorAll(".modal").forEach(e=>{e.classList.remove("active")}),productToDelete=null}function showToast(e,o="info"){let t=document.getElementById("toastContainer");t||(t=document.createElement("div"),t.id="toastContainer",t.style.cssText="\n            position: fixed;\n            top: 20px;\n            left: 20px;\n            z-index: 10000;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        ",document.body.appendChild(t));const n=document.createElement("div");n.className=`toast ${o}`,n.style.cssText=`\n        background: white;\n        padding: 15px 20px;\n        border-radius: 12px;\n        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        animation: slideIn 0.3s ease;\n        max-width: 300px;\n        border-right: 5px solid ${"success"===o?"var(--success-color)":"error"===o?"var(--danger-color)":"warning"===o?"var(--warning-color)":"var(--secondary-color)"};\n    `;let r="info-circle";"success"===o?r="check-circle":"error"===o?r="exclamation-circle":"warning"===o&&(r="exclamation-triangle"),n.innerHTML=`\n        <i class="fas fa-${r}" style="color: ${"success"===o?"var(--success-color)":"error"===o?"var(--danger-color)":"warning"===o?"var(--warning-color)":"var(--secondary-color)"}"></i>\n        <span>${e}</span>\n    `,t.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(-100%)",setTimeout(()=>n.remove(),300)},3e3)}async function loadButtonPressColorSettings(){try{console.log("ğŸ¨ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±...");const e=window.firebaseModules.doc(adminDb,"settings","theme_colors"),o=await window.firebaseModules.getDoc(e);if(o.exists()){const e=o.data().buttonPressColor||"#555555",t=document.getElementById("buttonPressColor"),n=document.getElementById("buttonPressColorHex");t&&(t.value=e),n&&(n.value=e),document.documentElement.style.setProperty("--button-press-color",e),console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:",e)}else console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆÙ† Ø£Ø²Ø±Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:",e)}}async function saveButtonPressColor(){try{console.log("ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±...");const e=document.getElementById("buttonPressColor").value;if(!e)return void showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ†","warning");const o=window.firebaseModules.doc(adminDb,"settings","theme_colors");await window.firebaseModules.setDoc(o,{buttonPressColor:e,updatedAt:window.firebaseModules.serverTimestamp()},{merge:!0}),document.documentElement.style.setProperty("--button-press-color",e),showToast("ØªÙ… Ø­ÙØ¸ Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­","success"),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:",e)}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±: "+e.message,"error")}}function setupColorInputSync(){[{color:"buttonPressColor",hex:"buttonPressColorHex"}].forEach(({color:e,hex:o})=>{const t=document.getElementById(e),n=document.getElementById(o);t&&n&&(t.addEventListener("change",e=>{n.value=e.target.value,updateButtonPressPreview(e.target.value)}),n.addEventListener("change",e=>{const o=e.target.value;/^#[0-9A-F]{6}$/i.test(o)?(t.value=o,updateButtonPressPreview(o)):(showToast("ØµÙŠØºØ© Ø§Ù„Ù„ÙˆÙ† ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ø³ØªØ®Ø¯Ù… ØµÙŠØºØ© HEX Ù…Ø«Ù„ #RRGGBB","warning"),n.value=t.value)}))})}function updateButtonPressPreview(e){const o=document.getElementById("buttonPressPreview");o&&(o.style.background=e);const t=document.getElementById("previewButtonPress");t&&(t.style.background=e)}async function resetButtonPressColor(){try{const e="#555555",o=document.getElementById("buttonPressColor"),t=document.getElementById("buttonPressColorHex");o&&(o.value=e),t&&(t.value=e),updateButtonPressPreview(e);const n=window.firebaseModules.doc(adminDb,"settings","theme_colors");await window.firebaseModules.setDoc(n,{buttonPressColor:e,updatedAt:window.firebaseModules.serverTimestamp()},{merge:!0}),document.documentElement.style.setProperty("--button-press-color",e),showToast("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ","success")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:",e),showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ","error")}}function logoutAdmin(){localStorage.removeItem("currentUser"),localStorage.removeItem("cart"),localStorage.removeItem("favorites"),window.location.href="index.html"}document.addEventListener("DOMContentLoaded",initAdminApp);let orderNotificationsUnsubscribe=null;function setupOrderNotificationsListener(){if(!adminDb)return;console.log("ğŸ”” Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª...");const e=window.firebaseModules.collection(adminDb,"notifications");orderNotificationsUnsubscribe&&orderNotificationsUnsubscribe(),orderNotificationsUnsubscribe=window.firebaseModules.onSnapshot(e,e=>{const o=e.docs.filter(e=>{const o=e.data();return"new_order"===o.type&&!o.read}).length;o>0&&showToast(`Ù„Ø¯ÙŠÙƒ ${o} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©`,"warning")},e=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª:",e)})}async function sendOrderStatusNotification(e,o){try{if(!adminDb||!e.userId||"guest"===e.userId)return;const t={pending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",paid:"ØªÙ… Ø§Ù„Ø¯ÙØ¹",processing:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²",shipped:"ØªÙ… Ø§Ù„Ø´Ø­Ù†",delivered:"ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",cancelled:"Ù…Ù„ØºÙŠ"},n=window.firebaseModules.collection(adminDb,"notifications");await window.firebaseModules.addDoc(n,{type:"order_status",title:"ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ",message:`ØªÙ… ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø±Ù‚Ù… ${e.orderId} Ø¥Ù„Ù‰ "${t[o]||o}"`,orderId:e.orderId,userId:e.userId,read:!1,priority:"medium",createdAt:window.firebaseModules.serverTimestamp()}),console.log("ğŸ”” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¹Ù…ÙŠÙ„")}catch(e){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:",e)}}async function generateOrderNumber(){return`NO:${await getNextOrderNumber()}`}window.openAddProductModal=openAddProductModal,window.editProduct=editProduct,window.confirmDeleteProduct=confirmDeleteProduct,window.deleteProductConfirmed=deleteProductConfirmed,window.saveProduct=saveProduct,window.loadAdminProducts=loadAdminProducts,window.loadAdminUsers=loadAdminUsers,window.loadAdminSettings=loadAdminSettings,window.loadAdminOrders=loadAdminOrders,window.updateOrderStatus=updateOrderStatus,window.deleteOrder=deleteOrder,window.showFullImage=showFullImage,window.downloadImage=downloadImage,window.closeModal=closeModal,window.logoutAdmin=logoutAdmin,window.saveAdminSettings=saveAdminSettings,window.saveButtonPressColor=saveButtonPressColor,window.resetButtonPressColor=resetButtonPressColor,window.loadButtonPressColorSettings=loadButtonPressColorSettings;